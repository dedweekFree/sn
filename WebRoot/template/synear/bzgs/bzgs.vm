<HTML>
<HEAD>		
<title>费用申请表</title>
<link rel="stylesheet" type="text/css" href="../../js/style.css">
<link rel="stylesheet" type="text/css" href="../../js/spellCode.css">
<meta http-equiv="Content-Type" content="text/html; charset=gb2312">


<script  src="../../../inc/js/treePicker.js" language="javascript"></script>
<script Language="JavaScript" src="../../../include/js/PopCalendar.js"></script>
<script src="../../../inc/js/pubjs.js"></script>
<script src="../../../inc/js/preAfter.js"></script>
<style> 
.FixedTitleRow 
{ 
position: relative; 
top: expression(this.offsetParent.scrollTop-2); 
z-index: 10; 
background-color: #E6ECF0; 
} 
.FixedTitleColumn 
{ 
position: relative; 
left: expression(this.parentElement.offsetParent.scrollLeft); 
} 
.FixedDataColumn 
{ 
position: relative; 
left: expression(this.parentElement.offsetParent.parentElement.scrollLeft); 
} 
.mainDiv    
{    
overflow:auto;    
scrollbar-face-color:9999ff; 
height:expression((document.body.clientHeight-this.offsetTop-20>this.children[0].offsetHeight)?(this.children[0].offsetHeight+20)   :   (document.body.clientHeight-this.offsetTop-20));    
width:expression((document.body.clientWidth-this.offsetLeft-20));   
}
</style> 

<SCRIPT LANGUAGE="JavaScript">

//查看
function ViewRow()
{  
   var obj = window.event.srcElement;
   obj = getParent(obj,"SPAN");
   var paras=obj.dtParams.split(",!");
   document.form1.pk_product.value = paras[1];
       document.form1.target="_self";
       document.form1.action="viewbzgs.aspx";
       document.form1.submit();
}
function ViewRow(billno)
{  
   var obj = window.event.srcElement;
   obj = getParent(obj,"SPAN");
   var paras=obj.dtParams.split(",!");
   document.form1.pk_product.value = paras[1];
       document.form1.target="_self";
      // document.form1.action="viewbzgs.aspx";
       document.form1.action="viewbzgs.aspx";
       document.form1.submit();
}
//报批
function okRow()
{  
   var obj = window.event.srcElement;
   obj = getParent(obj,"SPAN");
   var paras=obj.dtParams.split(",!");
   document.form1.billno.value = paras[1];
   document.form1.action="tempSalePlanOkSubmit.aspx";
   document.form1.target="saveframe";
   document.form1.submit();
}

//修改
function editRow()
{  
   var obj = window.event.srcElement;
   obj = getParent(obj,"SPAN");
   var paras=obj.dtParams.split(",!");
       document.form1.pk_product.value = paras[2];
      
       document.form1.pk_factory.value = paras[1];
       document.form1.deptname.value = paras[3];
       document.form1.invname.value = paras[5];
       document.form1.target="_self";
       document.form1.action="editWorkHours.aspx";
       document.form1.submit();
     
}

//删除
function DelRow()
{      
      var obj = window.event.srcElement;
	    obj = getParent(obj,"SPAN");
	   var paras=obj.dtParams.split(",!");
  
     if(confirm('你确定要删除吗？'))
     {
	    
       document.form1.pk_product.value = paras[2];
       document.form1.pk_factory.value = paras[1];
	   document.form1.action="delbzgsSubmit.aspx";
	   document.form1.target="saveframe";
	   document.form1.submit();
   }
}

//客户确认
function okRow2(st)
{  
   var obj = window.event.srcElement;
   obj = getParent(obj,"SPAN");
   var paras=obj.dtParams.split(",!");
   document.form1.billno.value = paras[0];
   document.form1.stok.value = st;
   document.form1.action="tempSalePlanOkSubmit2.aspx";
   document.form1.target="saveframe";
   document.form1.submit();
}

var dates = new Date(); 
current = dates.getYear()+"-"+(dates.getMonth()+1<10?'0'+(dates.getMonth()+1):dates.getMonth())+"-"+ dates.getDate()<10?'0'+dates.getDate():dates.getDate() ;
first ="" // dates.getYear()+"-"+(dates.getMonth()+1<10?'0'+(dates.getMonth()+1):String(dates.getMonth()+1))+"-"+'01';
last ="" // dates.getYear()+"-"+(dates.getMonth()+1<10?'0'+(dates.getMonth()+1):String(dates.getMonth()+1))+"-"+'31';

function ShowDate(idText){
 var state="dialogHeight: 300px; dialogWidth: 240px; dialogTop: 200px; dialogLeft: 300px; "+             "edge: Raised;  center: Yes; help: No; resizable: Yes; status: No;";

 var reValue=window.showModalDialog('../../../js/date.html?OpenForm',"myDate",state);
 if(reValue==null) 
   ;
 else
   idText.value=reValue;
 
 }

function checkinput()
{  
   document.thisform.page.value =1;
   if(document.all.thisform.custpk.value==""){
       alert("请选择分厂名称！");
	 return false;
    }
   thisform.action="bzgs.aspx";
   document.thisform.submit();
}

function checkinput2()
{  
	 document.thisform.page.value =1;
	 
      if(document.all.thisform.custpk.value==""){
         alert("请选择分厂名称！");
	 return false;
      }
      var deptname=getSelectedText("custpk");
      thisform.action="newWorkHours.aspx?deptname="+deptname;
      thisform.submit();
}

function getSelectedText(name)
{  
  var obj=document.getElementById(name);
  for(i=0;i<obj.length;i++)
  {
	  if(obj[i].selected==true)
	  {
		  return obj[i].innerText;
	  }
  }
}
//-->
</SCRIPT>
</HEAD>
<BODY>
<div>
  <form name="thisform" method="post" action="bzgs.aspx">
 
    <!--pageSize主要是完成分页功能，设置显示的记录的条数-->
   <input type="hidden" name="pageSize" value="$!form_pageSize">
   <input type="hidden" name="page" value="">

         <table border="0" cellspacing="1" cellpadding="0" bgcolor="#ffffff" width="98%" align="center"  class="datatable">
		<tr class="search"> 
			<td class="tdlabel" width="10%">分厂名称</td>
			<td class="tdinput" width="20%"><span class="style3 style1">
		#if($session_ROLES=="R1834")
			#foreach($n in $getCustUser)
			      $!n.ORGDESC<input type=hidden name=custpk value="$!n.PK_CORP1" >
			       <input type=hidden name=custcls value="$!n.ORGROLE" >
			        <input type=hidden name=plancls value="$!n.SISEL" >
			#end		   
		#else
			
			   
			   <select name=custpk id="custpk"><option value=''>请选择生产分厂</option>
               #foreach ($name in $getFcByuserName)
                <option value="$name.PK_FACTORY"  #if($form_custpk==$name.PK_FACTORY) selected #end>$name.DEPTNAME</option>
               #end
                    </select>
	        #end
              </span>		
			</td>	
			  <td>&nbsp;</td>  <td>&nbsp;</td>
                </tr>
		<tr>  <td>&nbsp;</td>
		 <td align="left"><input type="button" name="submit1" value="搜 索" onclick="checkinput()" class="bt1">
				&nbsp;&nbsp;	&nbsp;&nbsp;	&nbsp;&nbsp;
				
				</td>
				<td><input type="button" value="编辑" onclick="checkinput2()"  class="bt1"></td>
		
		  <td>&nbsp;</td>
		</tr>
		<tr>
		  <td>
		  </td><td align="left"></td>
		</tr>
	  </table>
</form>
</div>

<div class="mainDiv" id="mdiv"> 
<table border="0" cellspacing="0" cellpadding="0" bgcolor="#ffffff" width="98%" align="center" id="tb" 

class="datatable">
<tr height="20"  align="center"   class="FixedTitleRow">
	<td nowrap="nowrap" class="FixedTitleColumn">分厂名称</td>
	<td nowrap="nowrap" class="FixedTitleColumn">产品编码</td>
	<td nowrap="nowrap" class="FixedTitleColumn">产品名称</td>

	<td nowrap="nowrap">产品规格</td>
	<td nowrap="nowrap">标准用时</td>
	
	<td nowrap="nowrap">操作</td>
</tr>
    #set($i=1) 
    #foreach($m in $getbzgs)
  		<tr height="20" class="trcolor">
			<td align="center" nowrap="nowrap" class="FixedDataColumn">$!m.DEPTNAME</td>
			<td align="center" nowrap="nowrap" class="FixedDataColumn">$!m.INVCODE</td>
			<td align="center" nowrap="nowrap" class="FixedDataColumn">$!m.INVNAME</td>
			<td align="center" nowrap="nowrap" class="FixedDataColumn">$!m.INVSPEC</td>
			<td align="center" nowrap="nowrap" class="FixedDataColumn">$!m.FHOURS</td>
			<input type="hidden" name="fstatus" value="$m.FSTATUS">
			<input type="hidden" name="pk_product" value="$m.PK_PRODUCT">
			<input type="hidden" name="pk_factory" value="$m.PK_FACTORY">
			<td align="center" nowrap="nowrap"><span id="qxspan" dtParams=",!$!m.PK_FACTORY,!$!m.PK_PRODUCT,!$!m.DEPTNAME,!$!m.INVCODE,!$!m.INVNAME,!$!m.INVSPEC,!$!m.FHOURS,!$!m.MAKERUSER,!$!m.MAKERUSER2,!$!m.FSTATUS">
			     <a style='cursor:hand' onclick="javascript:editRow()"><font color=blue>修改</font></a>&nbsp;&nbsp;
			     <a style='cursor:hand' onclick="javascript:DelRow()"><font color=blue>删除</font></a>&nbsp;&nbsp;
			   #if($m.FSTATUS=="1"&&($m.MAKERUSER==$session_USERNAME) )
			        <a style='cursor:hand' onclick="javascript:ViewRow('$!m.BILLNO')"><font color=blue>明细</font></a>&nbsp;&nbsp;
			   #end
			   #if($m.FSTATUS=="2"&&($m.MAKERUSER==$session_USERNAME))
			        <a style='cursor:hand' onclick="javascript:ViewRow('$!m.BILLNO')"><font color=blue>明细</font></a>&nbsp;&nbsp;
			   #end
			   #if($m.FSTATUS=="3"&&($m.MAKERUSER==$session_USERNAME) )
				   
			        <a style='cursor:hand' onclick="javascript:ViewRow('$!m.BILLNO')"><font color=blue>明细</font></a>&nbsp;&nbsp;
			   #end
			</span></td>
		 </tr>
		 #set($i=$i+1)
   #end  
   #if($i==1)
     <tr height="20" bgcolor="#eeeeee" class="trcolor">
     <td colspan="9" bgcolor="#eeeeee" align="center" class="trcolor">没有相关信息</td>
     </tr>
   #end
</table>
</div>
<div>
		<table width="100%">
   <tr >
        <td class="tdlabel td">$pagecode</td>
   </tr>
</table>
</div>
<div align="center"><input type="button" class="login2" value=" 刷  新 " name="B222" onClick="javascript:window.location.reload();"> </div>
<form name="form1" method="post" action="salePlanOkSubmit.aspx">
<input type="hidden" name="deptname" id="deptname" value="">
<input type="hidden" name="pk_product" value="">
<input type="hidden" name="pk_factory" value="">
<input type="hidden" name="invname" value="">

</form>

<form name="form2" method="post" action="editInbill2.aspx">
   <input type="hidden" name="vbillcode" value="">
   <input type="hidden" name="vbatchcode" value="">
   <input type="hidden" name="indate" value="">
   <input type="hidden" name="pdate" value="">
</form>
<br>
<iframe name="saveframe" src="about:blank" width="100%" height="0" noresize frameborder=0 framespacing=0 

marginheight=0 marginwidth=0></iframe> 
</BODY>
</HTML>
