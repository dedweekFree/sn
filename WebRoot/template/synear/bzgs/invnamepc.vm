<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=gb2312" />
<link rel="stylesheet" type="text/css" href="../../../js/style.css">
<link rel="stylesheet" type="text/css" href="../../../js/spellCode.css">
<script src="../../inc/js/pubjs.js"></script>
<script src="../../inc/js/preAfter.js"></script>
<script  src="../../../inc/js/treePicker.js" language="javascript"></script>
<link rel='StyleSheet' href='../../js/dtree.css' type='text/css' />
<style> 
.FixedTitleRow 
{ 
position: relative; 
top: expression(this.offsetParent.scrollTop-2); 
z-index: 10; 
background-color: #E6ECF0; 
} 
.FixedTitleColumn 
{ 
position: relative; 
left: expression(this.parentElement.offsetParent.scrollLeft); 
} 
.FixedDataColumn 
{ 
position: relative; 
left: expression(this.parentElement.offsetParent.parentElement.scrollLeft); 
} 
.mainDiv    
{    
overflow:auto;    
scrollbar-face-color:9999ff; 
height:expression((document.body.clientHeight-this.offsetTop-20>this.children[0].offsetHeight)?(this.children[0].offsetHeight+20)   :   (document.body.clientHeight-this.offsetTop-20));    
width:expression((document.body.clientWidth-this.offsetLeft-20));   
}
</style> 
<title>产品排产明细</title>
<script language="javascript">
        function setVals(dm,mc,code) {
	      setVal(dm,mc);
	      thisform.ptype.value=code;
	      thisform.ptypename.value=mc;
	}
        var num1=0;
	 var num2=0;
	  var num3=0;
	 function toadd(url){
	    document.form2.action=url;
	    document.form2.submit();
	 }
	 function ShowDate(idText){
	 var state="dialogHeight: 300px; dialogWidth: 240px; dialogTop: 200px; dialogLeft: 300px; "+             "edge: Raised;  center: Yes; help: No; resizable: Yes; status: No;";
	 var reValue=window.showModalDialog('../../../js/date.html?OpenForm',"myDate",state);
	 if(reValue==null) 
		   ;
		 else
		   idText.value=reValue;
	    }

	    function todel(url){
	       if(confirm("确认要删除吗？")){
		      document.form2.target="saveframe";
		      document.form2.action=url;
		      document.form2.submit();
	      }
	    }
	    function toprint(url){
	       window.open(url,'','top='+(screen.height - 600) / 2 +',left='+(screen.width - 650) / 2 +',Toolbar=no,menubar=no,scrollbars=yes,status=yes,location=no,resizable=yes,directories=no,width=650,height=500');
	    }
	    function sub(){
		window.close();
	   }
	   function openwin(url){
		    window.open(url,'','top=0,left=0,Toolbar=no,menubar=no,scrollbars=yes,status=yes,location=no,resizable=yes,directories=no,width="+screen.width+",height="+screen.height+"');
		}
	function toprint(url){
		    window.open(url,'','top='+(screen.height - 600) / 2 +',left='+(screen.width - 650) / 2 +',Toolbar=no,menubar=no,scrollbars=yes,status=yes,location=no,resizable=yes,directories=no,width=650,height=500');
		}
         function init()
	{
	      var ss = "";
	      #foreach($m in $getinvnamepcplan)
	      try{
		  eval("document.all.A${m.INVCODE}C${m.SDATE}.innerText='$m.PLANNUM'");
	      }catch(e){}
	      #end
	}
	var dates = new Date(); 
	current = dates.getYear()+"-"+(dates.getMonth()+1<10?'0'+(dates.getMonth()+1):dates.getMonth())+"-"+ dates.getDate()<10?'0'+dates.getDate():dates.getDate() ;
	first ="" // dates.getYear()+"-"+(dates.getMonth()+1<10?'0'+(dates.getMonth()+1):String(dates.getMonth()+1))+"-"+'01';
	last ="" // dates.getYear()+"-"+(dates.getMonth()+1<10?'0'+(dates.getMonth()+1):String(dates.getMonth()+1))+"-"+'31';
        function checkinput()
	{  
	   document.thisform.submit();
	}
	function togetmont(url){
	    window.open(url,'','top='+(screen.height - 600) / 2 +',left='+(screen.width - 650) / 2 +',Toolbar=no,menubar=no,scrollbars=yes,status=yes,location=no,resizable=yes,directories=no,width=650,height=500');
	 }
</script>
</head>

<body onload="init();">
<p align="center">排产明细汇总</p>
<form name="thisform" method="post" >
   <table border="0" cellspacing="1" cellpadding="0" bgcolor="#ffffff" width="98%" align="center"  class="datatable">
	<tr class="search"> 
		  <td class="tdlabel" nowrap>开始时间(计划期间)</td>
			<td class="tdinput">
	      #if(!$form_begintime)
	       <script>
		document.write("<input type=text name=begintime size=10 readonly value='"+first+"'>");
	       </script>
	       #else
		 <input type=text name=begintime size=10 readonly value='$form_begintime'>
	       #end
	<input type="button" value="↓" onClick="ShowDate(begintime);" class="button" name="button23" >
		
		</td>	
		
		<td class="tdlabel" >结束时间</td>
		<td class="tdinput" >
		  #if(!$form_endtime)
		<script>
			document.write("<input type=text name=endtime size=10 readonly value='"+last+"'>");
		  </script>
		    #else
		 <input type=text name=endtime size=10 readonly value='$form_endtime'>
	       #end
		<input type="button" value="↓" onClick="ShowDate(endtime);" class="button" name="button23" >
		</td>
      </span>		
		</td>	
	</tr>
	<tr class="search">
	   <td class="tdlabel" width="10%">产品分类</td>
		<td  class="tdinput" width="20%" nowrap>
		<input type="text"  style="width:100" name="ptypename" value="$!form_ptypename" readonly>
		<input type="hidden" name="ptype" value="$!form_ptype">
		<input type='button' name=bt class='btn' value='选择' onclick="click_on_tree_selector($F('ptypename'),$F('dm_zzjg_tree_layer'))">
		<div class="dtree" id="dm_zzjg_tree_layer" style="position:absolute;width:300px;height:208px;visibility:Hidden;z-index:1"> 
		<table width="100%" border="1" cellspacing="0" cellpadding="0" height="100%"><tr><td>
			<IFRAME style="width:100%;height:100%" name="swjgdm_tree_frame" marginWidth=0 marginHeight=0 src="class_tree.aspx" frameBorder=0 
				width="100%" height="100%" scrolling=auto BORDERCOLOR="#000000" ></IFRAME>
		</td></tr></table>
		</div>
		<script>
		   selector_layers[selector_layers.length]=document.all.dm_zzjg_tree_layer;
		</script>				
		</td>	
	   <!-- <td  class="tdlabel">产品编码</td>  
		  <td  class="tdinput"><input type="text" name="invcode" value="$!form_invcode"></td>-->
	   <td  class="tdlabel">产品名称</td>  
	   <td  class="tdinput" ><input type="text" name="invname" id="invname" style="width:150" value="$!form_invname"><input type="button" value="..." onclick="togetmont('invnamequery.aspx')" class="bt1"></td>
	</tr>
	<tr>  <td>&nbsp;</td>
	 <td align="left"><input type="button" name="submit1" value="搜 索" onclick="checkinput()" class="bt1">
			&nbsp;&nbsp;	&nbsp;&nbsp;	&nbsp;&nbsp;
			
			</td>
			<td>&nbsp;</td>
	
	  <td><input type="button" class="bt1" name="btn" value="导出excel表"onclick="javascript:method1('tb');"></td>
	</tr>
  </table>
</form>
<table class="datatable" id="tb">
  <tr class="FixedTitleRow">
    <td nowrap>产品编码</td>
    <td nowrap>产品名称</td>
    <td nowrap>产品规格</td>
    #foreach($!m in $getinvnamepcday)
    <td nowrap>$m.BILLDATE</td>
    #end
  </tr>
  #set($i=1)
  #foreach($!m in $getinvnamepcdayplan)
  <tr class="trcolor">
    <td>$!m.INVCODE</td>
    <td>$!m.INVNAME</td>
    <td>$!m.INVSPEC</td>
    #foreach($n in $getinvnamepcday)
      <td id="A${m.INVCODE}C${n.SDATE}">0</td>
    #end
  </tr>
  #set($i=$i+1)
  #end
  
</table>
<form method="post" name="form2">
</form>
<iframe name="saveframe" src="about:blank" width="100%" height="0" noresize frameborder=0 framespacing=0 

marginheight=0 marginwidth=0></iframe>
</body>
</html>
<script>
function method1(tableid) {//整个表格拷贝到EXCEL中 
    var curTbl = document.getElementById(tableid); 
    var oXL = new ActiveXObject("Excel.Application"); 
    //创建AX对象excel 
    var oWB = oXL.Workbooks.Add(); 
    //获取workbook对象 
        var oSheet = oWB.ActiveSheet; 
    //激活当前sheet 
    var sel = document.body.createTextRange(); 
    sel.moveToElementText(curTbl); 
    //把表格中的内容移到TextRange中 
    sel.select(); 
    //全选TextRange中内容 
    sel.execCommand("Copy"); 
    //复制TextRange中内容  
    oSheet.Paste(); 
    //粘贴到活动的EXCEL中       
    oXL.Visible = true; 
    //设置excel可见属性 
} 
</script>