<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=gb2312" />
<link rel="stylesheet" type="text/css" href="../../js/style.css">
<link rel="stylesheet" type="text/css" href="../../js/spellCode.css">
<script  src="../../inc/js/treePicker.js" language="javascript"></script>
<script src="../../inc/js/pubjs.js"></script>
<script src="../../inc/js/preAfter.js"></script>
<title></title>
<script language='javascript'>
		var undefined;		
		function uniteTable(thistab,colLength){
		  var rn=thistab.rows.length;//取得行数   
		  var rowspann=0;   
		  for(j=colLength-1;j>=0;j--){//从第0列开始，合并多少列   
		    for(i=rn-1;i>0;i--){//从倒数第一行开始往上检查   
		      if(thistab.rows[i].cells[j].innerText==thistab.rows[i-1].cells[j].innerText&&thistab.rows[i].cells[j].colSpan==thistab.rows[i-1].cells[j].colSpan){//与上面一行比较，如果两行相等就合计当前行的合并行数，并删除当前行。   
			rowspann+=thistab.rows[i].cells[j].rowSpan;
			thistab.rows[i].deleteCell(j);
		      }else{
			thistab.rows[i].cells[j].rowSpan+=rowspann;//如果不等就完成当前相同数据的合并。   
			rowspann=0;
		      }   
		    }   
		    //检测无表头的表   
		    if(i==0&&rowspann>0){   
		      thistab.rows[i].cells[j].rowSpan+=rowspann;//如果不等就完成当前相同数据的合并。   
		      rowspann=0;   
		    }   
		  }  
		}
function ShowDate(idText){
	 var state="dialogHeight: 300px; dialogWidth: 240px; dialogTop: 200px; dialogLeft: 300px; "+"edge: Raised;  center: Yes; help: No; resizable: Yes; status: No;";
	 var reValue=window.showModalDialog('../../js/date.html?OpenForm',"myDate",state);
	 if(reValue==null) 
	   ;
	 else
	   idText.value=reValue;
	 }
	var duallist = new Array();
	duallist =[['制表时间1','制表时间2','制表人','客户']
	#set($i=0)
	#foreach($m in $seltabledual)
	,['$m.ITIME','$m.ITIME1','$m.PEOPLE','$m.CUSTNAME']
	#set($i=$i+1)
	#end
	]
	function getdual(){
		try{
			for(var i=1;i<=duallist.length;i++){
				if(duallist[i][0]!="")	document.thisform.itime.value=duallist[i][0].replace(/\s+/g,"");
				else document.thisform.itime.value=""
				if(duallist[i][1]!="")	document.thisform.itime1.value=duallist[i][1].replace(/\s+/g,"");
				else document.thisform.itime1.value=""
				if(duallist[i][2]!="")	document.thisform.people.value=duallist[i][2].replace(/\s+/g,"");
				else document.thisform.people.value=""
				if(duallist[i][3]!="")	document.thisform.custname.value=duallist[i][3].replace(/\s+/g,"");
				else document.thisform.custname.value=""
			}
		}catch(e){}
		for(var i=0;i<document.all.thisform.areapk.options.length;i++){   
		if(document.all.thisform.xxx.value.indexOf(document.all.thisform.areapk.options[i].value)>-1){
			     document.all.thisform.areapk.options[i].selected=true;
			}
		}
		var tab = document.getElementById("tab");
		for(var i=0;i<tab.rows.length;i++){
			if(tab.rows[i].cells[1].innerHTML=="zongji"){
				tab.rows[i].cells[1].innerHTML='总计';
			}
			if(tab.rows[i].cells[2].innerHTML=="heji"){
				tab.rows[i].cells[2].innerHTML='合计';
			}
			if(tab.rows[i].cells[3].innerHTML=="xiaoji"){
				tab.rows[i].cells[3].innerHTML='小计';
			}
		}
		uniteTable(tab,3);
		stree.location='../plan/class_tree.aspx';
	}
	function setVals(dm,mc,code) {
	      setVal(dm,mc);
	      document.thisform.ptype.value=code;
	      document.thisform.ptypename.value=mc;
		}
	function checkinput(){
		if(document.thisform.itime.value==""||document.thisform.itime1.value==""){
			alert("制表时间没有填写!");
		}else{
			thisform.submit();
		}
	}
	</script>
	<script language="javascript">
	var dept=new Array(); 
		dept=[
		   ['区域主键','区域名称','大区主键']
		   #set($i=0)
		   #foreach($!m in $getCustdept)
		   ,['$m.DEPT_PK','$m.DEPTNAME','$m.NC_PK']
		   #set($i=$i+1)
		   #end
		   ]
		   function setF(departid,objid){
		    if(departid==""){
			  var obj = document.getElementById(objid);
			  var length = obj.length;
			  for (var j=length-1; j>0; j--)
			  {
			    obj.options.remove(j);
			  }
			  for(var i=1;i<dept.length;i++){   
			      var oOption = document.createElement("OPTION");
			      obj.options.add(oOption);
			      oOption.innerText = dept[i][1];
			      oOption.value = dept[i][0];
			  }	  
		    }else{
		      var obj = document.getElementById(objid);
		      var length = obj.length;
		      for (var j=length-1; j>0; j--)
		      {
			obj.options.remove(j);
		      }
			 
		      for(var i=1;i<dept.length;i++){
			if(dept[i][2]==departid){
			  var oOption = document.createElement("OPTION");
			  obj.options.add(oOption);
			  oOption.innerText = dept[i][1];
			  oOption.value = dept[i][0];
			}
		      }
		    }
		}
</script>
	<script>
	function abc(){
	var cal='';
	for(var i=0;i<document.all.thisform.areapk.options.length;i++){   
		if(document.all.thisform.areapk.options[i].selected){
		     if(document.all.thisform.areapk.options[i].value!='')
		     cal=cal+document.all.thisform.areapk.options[i].value+',';
		}
	}	
	document.all.thisform.xxx.value=cal;
	}
</script>
</head>

<body onload="getdual()">
<form name='thisform' method='post' action='selcusttable.aspx'>
<table class="datatable">
  <tr class="trcolor">
    <td align='right'>制表时间:</td>
    <td align='left'><input type="text" name="itime" onclick="ShowDate(itime)"/>
		-<input type="text" name="itime1" onclick="ShowDate(itime1)"/>
    </td>
    <td align='right'>制表人:</td>
    <td align='left'><input type="text" name="people" /></td>
  </tr>
  <tr class="trcolor">
    <td align='right'>大&nbsp;&nbsp;&nbsp;&nbsp;区:</td>
    <td align='left'>
    <select name="areapk" onchange="javascript:setF(this.value,'deptname');">
    <option value="">请选择大区</option>
    #set($i=0)
    #foreach($m in $getCustbig)
    <option value="$m.NC_PK">$m.BIGAREA</option>
    #set($i=$i+1)
    #end
    </select>
    #set($i=0)
    #foreach($m in $seltabledual)
    <input type="hidden" name="xxx" value="$m.AREAPK">
    #set($i=$i+1)
    #end
    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align='right'>所属区域</td>
    <td align='left'>
          <select name="deptname">
	  <option value=''>请选择区域</option>
	   #set($i=0)
	   #foreach($!m in $getCustdept)
	   <option value="$m.DEPT_PK">$m.DEPTNAME</option>
	   #set($i=$i+1)
           #end
	   </select>
    	   <script>
                    setF('$form_areapk','deptname');
		    document.getElementById('deptname').value='$form_deptname';
	   </script>
    </td>
    </tr>  
  <tr class="trcolor">
    <td align='right'>客&nbsp;&nbsp;户:</td>
    <td align='left'><select name="custname">
    <option value="">请选择客户</option>
    #set($i=0)
    #foreach($m in $getCustbig2)
    <option value="$m.ORGDESC">$m.ORGDESC</option>
    #set($i=$i+1)
    #end
    </select>
    <input type="hidden" name="aaa" value="1"/>
    </td>
    <td align='right'>产品系列:</td>
    <td align='left'>	        <input type="text" name="ptypename" value=""  readonly>
				<input type="hidden" name="ptype" value="">
				<input type='button' name=bt class='btn' value='选择' onclick="click_on_tree_selector($F('ptypename'),$F('dm_zzjg_tree_layer'))">
				<div class="dtree" id="dm_zzjg_tree_layer" style="position:absolute;width:300px;height:208px;visibility:Hidden;z-index:1"> 
				<table width="100%" border="1" cellspacing="0" cellpadding="0" height="100%"><tr><td>
					<IFRAME style="width:100%;height:100%" id='stree' name="swjgdm_tree_frame" marginWidth=0 marginHeight=0 src="" frameBorder=0 
						width="100%" height="100%" scrolling=auto BORDERCOLOR="#000000" ></IFRAME>
				</td></tr></table>
			        </div>
			        <script>
				   selector_layers[selector_layers.length]=document.all.dm_zzjg_tree_layer;
			        </script>
    </td>
    </tr>
    <tr>
    <td>&nbsp;</td>
    <td align="left"><input type="button" name="button" value="查  询" onclick="checkinput()"/></td>
    <td>&nbsp;</td>
    <td align="left"><input type="button" name="exc" value="导出Excel" onclick="javascript:method1('tab');"/></td>
  </tr>
</table>
</form>
<br>
<table class="datatable" id="tab">
  <tr class="trcolor">
    <td rowspan="2">序号</td>
    <td rowspan="2">大类</td>
    <td rowspan="2">系列</td>
    <td rowspan="2">品名</td>
    <td rowspan="2">规格</td>
    <td rowspan="2">合计</td>
    <td colspan="4">产品日期结构</td>
    <td rowspan="2">上月月<br>底库存</td>
  </tr>
  <tr class="trcolor">
    <td>60天以内的库存量</td>
    <td>61-90天的库存量</td>
    <td>91-120天的库存量</td>
    <td>120天以上的库存量</td>
  </tr>
#set($i=1)
#foreach($m in $selcusttable)
	#if($m.ITEMSPEC !="-" || ($m.ITEMDESC == "xiaoji" && $m.ITEMCODE=="-"))
	<tr class="trcolor">
	    <td>$i</td>
	    <td>$m.FATHER_CLASSNAME</td>
	    <td>$m.INVCLASSNAME</td>
	    <td>$m.ITEMDESC</td>
	    <td>$m.ITEMSPEC</td>
	    <td>$m.NNUM</td>
	    <td>$m.STY</td>
	    <td>$m.NTY</td>
	    <td>$m.TWTY</td>
	    <td>$m.OTH</td>
	    <td>$m.TTOP</td>
	  </tr>
	#set($i=$i+1)
	#end
#end
</table>
</body>
</html>
<script>
function method1(tableid) {//整个表格拷贝到EXCEL中 
    var curTbl = document.getElementById(tableid); 
    var oXL = new ActiveXObject("Excel.Application"); 
    //创建AX对象excel 
    var oWB = oXL.Workbooks.Add(); 
    //获取workbook对象 
        var oSheet = oWB.ActiveSheet; 
    //激活当前sheet 
    var sel = document.body.createTextRange(); 
    sel.moveToElementText(curTbl); 
    //把表格中的内容移到TextRange中 
    sel.select(); 
    //全选TextRange中内容 
    sel.execCommand("Copy"); 
    //复制TextRange中内容  
    oSheet.Paste(); 
    //粘贴到活动的EXCEL中       
    oXL.Visible = true; 
    //设置excel可见属性 
} 
</script>