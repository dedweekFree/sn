<HTML>
<HEAD>		
<title>费用申请表</title>
<link rel="stylesheet" type="text/css" href="../../js/style.css">
<link rel="stylesheet" type="text/css" href="../../js/spellCode.css">
<meta http-equiv="Content-Type" content="text/html; charset=gb2312">


<script  src="../../../inc/js/treePicker.js" language="javascript"></script>
<script Language="JavaScript" src="../../../include/js/PopCalendar.js"></script>
<script src="../../../inc/js/pubjs.js"></script>
<script src="../../../inc/js/preAfter.js"></script>
<style> 
.FixedTitleRow 
{ 
position: relative; 
top: expression(this.offsetParent.scrollTop-2); 
z-index: 10; 
background-color: #E6ECF0; 
} 
.FixedTitleColumn 
{ 
position: relative; 
left: expression(this.parentElement.offsetParent.scrollLeft); 
} 
.FixedDataColumn 
{ 
position: relative; 
left: expression(this.parentElement.offsetParent.parentElement.scrollLeft); 
} 
.mainDiv    
{    
overflow:auto;    
scrollbar-face-color:9999ff; 
height:expression((document.body.clientHeight-this.offsetTop-20>this.children[0].offsetHeight)?(this.children[0].offsetHeight+20)   :   (document.body.clientHeight-this.offsetTop-20));    
width:expression((document.body.clientWidth-this.offsetLeft-20));   
}
</style> 

<SCRIPT LANGUAGE="JavaScript">

//查看
function ViewRow(billno)
{  
   var obj = window.event.srcElement;
   obj = getParent(obj,"SPAN");
   var paras=obj.dtParams.split(",!");
       document.form1.custcode.value = billno;
       document.form1.target="_self";
       document.form1.action="view.aspx";
       document.form1.submit();
}

//修改
function editRow(fstatus)
{  
	//!$!m.BILLNO,!$!m.PK_FACTORY,!$!m.BILLDATE,!$!m.DEPTNAME,!$!m.PLANNUM,
	//!$!m.REALHOURS,!$!m.MAKERUSER,!$!m.FSTATUS,!$!m.TS1">

   var obj = window.event.srcElement;
   obj = getParent(obj,"SPAN");
   var paras=obj.dtParams.split(",!");
       document.form1.billno.value = paras[1];
       document.form1.pk_factory.value = paras[2];
       document.form1.billdate.value = paras[3];
       document.form1.plannum.value=paras[5];
       document.form1.realhours.value=paras[6];
       document.form1.makeruser.value=paras[7];
       document.form1.ts1.value=paras[9];
       document.form1.fstatus.value=fstatus;
       document.form1.target="_self";
       document.form1.action="editPaiChan.aspx";
       document.form1.submit();
}


var dates = new Date(); 
current = dates.getYear()+"-"+(dates.getMonth()+1<10?'0'+(dates.getMonth()+1):dates.getMonth())+"-"+ dates.getDate()<10?'0'+dates.getDate():dates.getDate() ;
first ="" // dates.getYear()+"-"+(dates.getMonth()+1<10?'0'+(dates.getMonth()+1):String(dates.getMonth()+1))+"-"+'01';
last ="" // dates.getYear()+"-"+(dates.getMonth()+1<10?'0'+(dates.getMonth()+1):String(dates.getMonth()+1))+"-"+'31';

function ShowDate(idText){
 var state="dialogHeight: 300px; dialogWidth: 240px; dialogTop: 200px; dialogLeft: 300px; "+             "edge: Raised;  center: Yes; help: No; resizable: Yes; status: No;";

 var reValue=window.showModalDialog('../../../js/date.html?OpenForm',"myDate",state);
 if(reValue==null) 
   ;
 else
   idText.value=reValue.substr(0,7);
 
 }

function checkinput()
{  
   document.thisform.page.value =1;
   document.thisform.submit();
}

function checkinput2()
{  
	 document.thisform.page.value =1;
	 if(document.all.thisform.begintime.value==""){
		   alert("请选择开始时间！");
		   return false;
	   }
      if(document.all.thisform.custpk.value==""){
         alert("请选择分厂名称！");
	    return false;
      }
	  document.all.thisform.pk_product.value=document.all.thisform.custpk.value;
	  document.all.thisform.deptname.value=getSelectedText("custpk");
	  document.all.thisform.action="testPlan.aspx";
      document.all.thisform.target="saveframe";
      document.all.thisform.submit();
}
function testok()
{ 
	document.all.form1.custpk.value=document.all.thisform.custpk.value;
	
	document.all.form1.deptname.value=getSelectedText("custpk");
	document.all.form1.billdate.value=document.all.thisform.begintime.value;
	document.all.form1.action="newPaiChan.aspx";
    document.all.form1.submit();
}

//获取下拉列表选中项的文本
function getSelectedText(name){
var obj=document.getElementById(name);
for(i=0;i<obj.length;i++){
   if(obj[i].selected==true){
    return obj[i].innerText;      //关键是通过option对象的innerText属性获取到选项文本
   }
}
}

 function addfile(){
      if(document.all.thisform.custpk.value==""){
         alert("请选择分厂名称！");
	    return false;
      }
      var f_id="PC"+getTimeStr();
     window.open('paichanpfile.jsp?formname=form1&myframeurl=myframe&picurl=paper&type=custfile&tendtypeid=pcexcel&custpk='+document.all.thisform.custpk.value+'&billno='+f_id,'','status=no,scrollbars=no,top=160,left=150,width=450,height=365');
}

function getTimeStr()     
{  
   var str="";
   var date = new Date();
   var field="";
   str= date.getFullYear()+"";
   field=(date.getMonth()+1);
   if(date.getMonth()<9){
	   str = str+"0"+field;
   }else{
	   str = str+field;
   }
   field= date.getDate();
   if(date.getDate()<10){
	   str = str+"0"+field;
   }else{
	   str = str+field;
   }
   str= str+""+date.getHours()+""+date.getMinutes()+""+date.getSeconds();
   return str;  
}

function exportfile(){
   thisform.action = "exprot.exl";
   thisform.submit();
}

function todel(){
   var MyDate=new Date();
        var Year=MyDate.getFullYear();
        var MonthNum=MyDate.getMonth();
        var Month;
        if(MonthNum<9){
            Month="0"+(MonthNum+1);
        }else{
            Month=MonthNum+1;
        }
        var Day=MyDate.getDate();
        if(Day<=9){
            Day="0"+Day;
        }
        var Today=Year+"-"+Month+"-"+Day;
   if(document.thisform.begintime.value == ""){
      alert("请选择开始时间");
      return false;
   }else{
      /* if(document.thisform.begintime.value <= Today){
          alert("开始时间不能小于等于当天");
	  return false;
       } */
   }
   if(document.thisform.endtime.value == ""){
      alert("请选择结束时间");
      return false;
   }
   if(confirm('你确定要删除吗？'))
   {
   //document.form1.begintime.value = document.thisform.begintime.value;
   //document.form1.endtime.value = document.thisform.endtime.value;
   document.thisform.target = "saveframe";
   document.thisform.action = "paichandel.aspx";
   document.thisform.submit();
   }
}
function downfile()
	{
	   thisform.action="cxwlexcel.exl";
	   thisform.submit();
	}
//-->
</SCRIPT>
</HEAD>
<BODY>
<div>
  <form name="thisform" method="post" action="cxwlimp.aspx">
 
    <!--pageSize主要是完成分页功能，设置显示的记录的条数-->
   <input type="hidden" name="pageSize" value="$!form_pageSize">
   <input type="hidden" name="page" value="">
   <input type="hidden" name="pk_product" value="">
   <input type="hidden" name="pk_factory" value="">
   <input type="hidden" name="periodno" value="">
   <input type="hidden" name="plandate" value="">

         <table border="0" cellspacing="1" cellpadding="0" bgcolor="#ffffff" width="98%" align="center"  class="datatable">
      		     <tr class="search"> 
			  <td class="tdlabel" width="10%">开始月份</td>
				<td class="tdinput" width="20%">
                      #if(!$form_begintime)
                       <script>
			document.write("<input type=text name=begintime size=10 readonly value='"+first+"'>");
                       </script>
		       #else
		         <input type=text name=begintime size=10 readonly value='$form_begintime'>
		       #end
		<input type="button" value="↓" onClick="ShowDate(begintime);" class="button" name="button23" >
			
			</td>	
			
			<td class="tdlabel" width="10%">结束月份</td>
			<td class="tdinput" width="20%">
			  #if(!$form_endtime)
			<script>
				document.write("<input type=text name=endtime size=10 readonly value='"+last+"'>");
			  </script>
			    #else
		         <input type=text name=endtime size=10 readonly value='$form_endtime'>
		       #end
			<input type="button" value="↓" onClick="ShowDate(endtime);" class="button" name="button23" >

			</td>
			
			</td>	
                </tr>
		<tr class="search"> 
			<td class="tdlabel" width="10%">客户编码</td>
			<td class="tdinput" width="20%">
			    <input type="text" name="custcode" value="$!form_custcode">
			</td>	
			  <td class="tdlabel">客户名称</td>  
			  <td  class="tdinput"  align="left"><input type="text" name="custname" value="$!form_custname"></td>
                </tr>
		<tr>  <td>&nbsp;</td>
		 <td align="left">
		    <input type="button" name="submit1" value="搜 索" onclick="checkinput()" class="bt1">
			<!--	&nbsp;&nbsp;	&nbsp;&nbsp;	&nbsp;&nbsp;
		    <input type="button" name="submit112" value="删 除" onclick="todel()" class="bt1">-->
				</td>
		   <td>&nbsp;<!--<input type="button" value="新建" onclick="checkinput2()"  class="bt1">--></td>
		
		  <td>&nbsp;&nbsp;<input type="button" class="bt1" name="btnss" value="导出excel" onclick="downfile()"></td>
		</tr>
		<tr>
		  <td>
		  </td><td align="left"></td>
		</tr>
	  </table>
</form>
</div>

<table border="0" cellspacing="0" cellpadding="0" bgcolor="#ffffff" width="98%" align="center" id="tb" 

class="datatable">
<tr height="20"  align="center"   class="FixedTitleRow">
	<td nowrap="nowrap" class="FixedTitleColumn">发放物料时间</td>
	<td nowrap="nowrap" class="FixedTitleColumn">客户编码</td>
	<td nowrap="nowrap" class="FixedTitleColumn">客户名称</td>
	<td nowrap="nowrap">物料名称</td>
	<td nowrap="nowrap">计量单位</td>
	<td nowrap="nowrap">出库数量</td>
	<td nowrap="nowrap">实收数量</td>
	<td nowrap="nowrap">出库单价</td>
	<td nowrap="nowrap">出库金额（元）</td>
	<!--<td nowrap="nowrap">操作</td>-->
</tr>
    #set($i=1) 
    #foreach($m in $jxscxwldzquerybypage)
	<tr height="20" class="trcolor">
	     <td align="center" nowrap="nowrap" class="FixedDataColumn">$!m.SENDDATE</td>
		<td align="center" nowrap="nowrap" class="FixedDataColumn">$!m.CUSTCODE</td>
		<td align="center" nowrap="nowrap" class="FixedDataColumn">$!m.CUSTNAME</td>
		<td align="center" nowrap="nowrap" class="FixedDataColumn">$!m.WLNAME</td>
		<td align="center" nowrap="nowrap" class="FixedDataColumn">$!m.UNITNAME</td>
		<td align="center" nowrap="nowrap" class="FixedDataColumn">$!m.NNUM</td>
		<td align="center" nowrap="nowrap" class="FixedDataColumn">#if($!m.SNNUM!="")$!m.SNNUM#else&nbsp;#end</td>
		<td align="center" nowrap="nowrap" class="FixedDataColumn">$!m.PRICE</td>
		<td align="center" nowrap="nowrap" class="FixedDataColumn">$!m.MONEY</td>
		<!--<td align="center" nowrap="nowrap"><span id="qxspan" dtParams=",!$!m.CUSTCODE,!$!m.SENDDATE">
		   <a style='cursor:hand' onclick="javascript:ViewRow('$!m.CUSTCODE')"><font color=blue>明细</font></a>
		</span></td>-->
	 </tr>
	 #set($i=$i+1)
   #end  
   #if($i==1)
     <tr height="20" bgcolor="#eeeeee" class="trcolor">
     <td colspan="8" bgcolor="#eeeeee" align="center" class="trcolor">没有相关信息</td>
     </tr>
   #else
      #foreach($m in $jxscxwldzquerybypagesum)
          <tr height="20" class="trcolor">
	     <td align="center" nowrap="nowrap">合计</td>
		<td align="center" nowrap="nowrap">&nbsp;</td>
		<td align="center" nowrap="nowrap">&nbsp;</td>
		<td align="center" nowrap="nowrap">&nbsp;</td>
		<td align="center" nowrap="nowrap">&nbsp;</td>
		<td align="center" nowrap="nowrap">$!m.NNUM</td>
		<td align="center" nowrap="nowrap">#if($!m.SNNUM!="")$!m.SNNUM#else&nbsp;#end</td>
		<td align="center" nowrap="nowrap">&nbsp;</td>
		<td align="center" nowrap="nowrap">$!m.MONEY</td>
		<!--<td align="center" nowrap="nowrap">&nbsp;</td>-->
	 </tr>
      #end
   #end
</table>
		<table width="100%">
   <tr >
        <td class="tdlabel td">$pagecode</td>
   </tr>
</table>
<div align="center"><input type="button" class="login2" value=" 刷  新 " name="B222" onClick="javascript:window.location.reload();"> </div>
<form name="form1" method="post">
  <input type="hidden" name="custcode" value="">
  <input type="hidden" name="senddate" value="">
</form>

<iframe name="saveframe" src="about:blank" width="100%" height="0" noresize frameborder=0 framespacing=0 

marginheight=0 marginwidth=0></iframe> 
</BODY>
</HTML>
