<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=gb2312" />
<link rel="stylesheet" type="text/css" href="../../../js/style.css">
<link rel="stylesheet" type="text/css" href="../../../js/spellCode.css">
<script  src="../../inc/js/treePicker.js" language="javascript"></script>
<script src="../../inc/js/pubjs.js"></script>
<script src="../../inc/js/preAfter.js"></script>
<link rel='StyleSheet' href='../../js/dtree.css' type='text/css' />
<title>=====</title>
<script language="javascript">
        var num=0;
	var num1=0;
	var num2=0;
	var num3=0;
	var num4=0;
	var num5=0;
	var num6=0;
	var num7=0;
	var num8=0;
	var num9=0;
	function sub(){
		document.thisform.page.value =1;
		document.thisform.submit();
	}
function setVals(dm,mc,code) {
	      setVal(dm,mc);
	      document.thisform.ptype.value=code;
	      document.thisform.ptypename.value=mc;
	 }
	 function ShowDate(idText){
	 var state="dialogHeight: 300px; dialogWidth: 240px; dialogTop: 200px; dialogLeft: 300px; "+             "edge: Raised;  center: Yes; help: No; resizable: Yes; status: No;";

	 var reValue=window.showModalDialog('../../../js/date.html?OpenForm',"myDate",state);
	 if(reValue==null) 
	   ;
	 else
	   idText.value=reValue;
	 
	 }
</script>
</head>

<body>
<form name="thisform" method="post" action="stockyearinoutquery.aspx">
    <!--pageSize主要是完成分页功能，设置显示的记录的条数-->
   <input type="hidden" name="pageSize" value="$!form_pageSize">
   <input type="hidden" name="page" value="">
<table class="datatable">
  <tr class="trcolor"> 
      <td class="tdlabel" width="10%">入库开始日期</td>
	<td class="tdinput" width="20%">
	 <input name="indate" type="text" class="login" id="indate" value="$!form_indate" readonly><input type="button" value="↓" onClick="ShowDate(indate);" class="button" name="button23" >
	</td>
	<td class="tdlabel" width="10%">入库结束日期</td>
	<td class="tdinput" width="20%">
	 <input name="enddate" type="text" class="login" id="enddate" value="$!form_enddate" readonly><input type="button" value="↓" onClick="ShowDate(enddate);" class="button" name="button23" >
	</td>
</tr>
  <tr class="trcolor">
    <td>产品分类</td>
   <td align="left"><input type="text" name="ptypename" value="$!form_ptypename"  readonly>
	<input type="hidden" name="ptype" value="#if($!form_ptype!='')$!form_ptype#end">
	<input type='button' name=bt class='bt1' value='选择' onclick="click_on_tree_selector($F('ptypename'),$F('dm_zzjg_tree_layer'))">
	<div class="dtree" id="dm_zzjg_tree_layer" style="position:absolute;width:300px;height:208px;visibility:Hidden;z-index:1"> 
	<table width="100%" border="1" cellspacing="0" cellpadding="0" height="100%"><tr><td>
		<IFRAME style="width:100%;height:100%" id='stree' name="swjgdm_tree_frame" marginWidth=0 marginHeight=0 src="class_tree.aspx" frameBorder=0 
			width="100%" height="100%" scrolling=auto BORDERCOLOR="#000000" ></IFRAME>
	</td></tr></table>
	</div>
	<script>
	   selector_layers[selector_layers.length]=document.all.dm_zzjg_tree_layer;
	</script>
    </td>
    <td>产品明细</td>
    <td align="left"><input type="text" name="pname" value="$!form_pname" /></td>
  </tr>
  <tr class="trcolor">
    <td>仓库</td>
    <td  align="left">
        <select name="stockname">
	<option value=""></option>
             #foreach($!m in $stockyearstockquery)
                <option value="$m.STORNAME" #if($!form_stockname != "")#if($!form_stockname==$m.STORNAME)selected#end#end>$m.STORNAME</option>
	     #end
	</select>
    </td>
    <td>&nbsp;</td>
    <td align="left">&nbsp;</td>
  </tr>
  <tr class="trcolor">
    
  </tr>
  <tr class="trcolor">
    <td colspan="4"><input type="button" name="b1" class="bt1" value="查  询" onclick="sub()"/>&nbsp;<input type="button" class="bt1" name="btn" value="导出excel表"onclick="javascript:method1('tb');"></td>
  </tr>
</table>
</form>
<br>
<table class="datatable" id="tb">
  <tr class="trcolor">
    <td>序号</td>
    <td>产品大类</td>
    <td>产品名称</td>
    <td>产品编码</td>
    <td>仓库</td>
    <td>上期结存</td>
    <td>入库数量</td>
    <td>移入数量</td>
    <td>调入数量</td>
    <td>其他入库数量</td>
    <td>出库数量</td>
    <td>移出数量</td>
    <td>调出数量</td>
    <td>其他出库数量</td>
    <td>本期结存</td>
  </tr>
  #set($i=1)
  #foreach($!m in $stockyearjiecuncodequery)
  <tr class="trcolor">
    <td>$i</td>
    <td>$!m.INVCLASSNAME</td>
    <td>$!m.INVNAME</td>
    <td>$!m.INVCODE</td>
    <td>$!m.STORNAME</td>
    <td>$!m.SQJCNNUMBER</td>
    <td>$!m.INNUMBER</td>
    <td>$!m.YRNNUMBER</td>
    <td>$!m.DRNNUMBER</td>
    <td>$!m.QRNNUMBER</td>
    <td>$!m.OUTNNUMBER</td>
    <td>$!m.YCNNUMBER</td>
    <td>$!m.DCNNUMBER</td>
    <td>$!m.QCNNUMBER</td>
    <td>$!m.BQJCNNUMBER</td>
  </tr>
  #set($i=$i+1)
  <script>
        num+=$m.SQJCNNUMBER;
	num1+=$m.INNUMBER;
	num2+=$m.YRNNUMBER;
	num3+=$m.DRNNUMBER;
	num4+=$m.OUTNNUMBER;
	num5+=$m.YCNNUMBER;
	num6+=$m.DCNNUMBER;
	num7+=$m.BQJCNNUMBER;
        num8+=$m.QRNNUMBER;
	num9+=$m.QCNNUMBER;
  </script>
  #end
  <tr height="20" class="trcolor">
       <td colspan="5" align="center">小    计</td>
       <td align="center" nowrap="nowrap">
	  <script>
	    document.write(num);
	  </script>
	</td>
	<td align="center" nowrap="nowrap">
	  <script>
	    document.write(num1);
	  </script>
	</td>
	<td align="center" nowrap="nowrap">
	  <script>
	    document.write(num2);
	  </script>
	</td>
	<td align="center" nowrap="nowrap">
	  <script>
	    document.write(num3);
	  </script>
	</td>
	<td align="center" nowrap="nowrap">
	  <script>
	    document.write(num8);
	  </script>
	</td>
	<td align="center" nowrap="nowrap">
	  <script>
	    document.write(num4);
	  </script>
	</td>
	<td align="center" nowrap="nowrap">
	  <script>
	    document.write(num5);
	  </script>
	</td>
	<td align="center" nowrap="nowrap">
	  <script>
	    document.write(num6);
	  </script>
	</td>
	<td align="center" nowrap="nowrap">
	  <script>
	    document.write(num9);
	  </script>
	</td>
	<td align="center" nowrap="nowrap">
	  <script>
	    document.write(num7);
	  </script>
	</td>
  </tr>
  #foreach($n in $stockyearjiecuncodequerysum)
        <tr height="20" class="trcolor">
	    <td colspan="5" align="center">合    计</td>
	     <td align="center" nowrap="nowrap">#if($n.SQJCNNUMBER == "")0#else$n.SQJCNNUMBER#end</td>
	     <td align="center" nowrap="nowrap">#if($n.INNUMBER == "")0#else$n.INNUMBER#end</td>
	     <td align="center" nowrap="nowrap">#if($n.YRNNUMBER == "")0#else$n.YRNNUMBER#end</td>
	     <td align="center" nowrap="nowrap">#if($n.DRNNUMBER == "")0#else$n.DRNNUMBER#end</td>
	     <td align="center" nowrap="nowrap">#if($n.QRNNUMBER == "")0#else$n.QRNNUMBER#end</td>
	     <td align="center" nowrap="nowrap">#if($n.OUTNNUMBER == "")0#else$n.OUTNNUMBER#end</td>
	     <td align="center" nowrap="nowrap">#if($n.YCNNUMBER == "")0#else$n.YCNNUMBER#end</td>
	     <td align="center" nowrap="nowrap">#if($n.DCNNUMBER == "")0#else$n.DCNNUMBER#end</td>
	     <td align="center" nowrap="nowrap">#if($n.QCNNUMBER == "")0#else$n.QCNNUMBER#end</td>
	     <td align="center" nowrap="nowrap">#if($n.BQJCNNUMBER == "")0#else$n.BQJCNNUMBER#end</td>
	</tr>
  #end
 <tr>
        <td class="tdlabel" colspan="15">$pagecode</td>
   </tr>
</table>
</body>
</html>
<script>
function method1(tableid) {//整个表格拷贝到EXCEL中 
    var curTbl = document.getElementById(tableid); 
    var oXL = new ActiveXObject("Excel.Application"); 
    //创建AX对象excel 
    var oWB = oXL.Workbooks.Add(); 
    //获取workbook对象 
        var oSheet = oWB.ActiveSheet; 
    //激活当前sheet 
    var sel = document.body.createTextRange(); 
    sel.moveToElementText(curTbl); 
    //把表格中的内容移到TextRange中 
    sel.select(); 
    //全选TextRange中内容 
    sel.execCommand("Copy"); 
    //复制TextRange中内容  
    oSheet.Paste(); 
    //粘贴到活动的EXCEL中       
    oXL.Visible = true; 
    //设置excel可见属性 
} 
</script>