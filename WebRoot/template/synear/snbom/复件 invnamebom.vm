<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=gb2312" />
<link rel="stylesheet" type="text/css" href="../../../js/style.css">
<link rel="stylesheet" type="text/css" href="../../../js/spellCode.css">
<script  src="../../inc/js/treePicker.js" language="javascript"></script>
<script src="../../inc/js/pubjs.js"></script>
<script src="../../inc/js/preAfter.js"></script>
<link rel='StyleSheet' href='../../js/dtree.css' type='text/css' />
<title>=====</title>
<script language="javascript">
        var num1=0;
	function sub(){
		document.thisform.page.value =1;
		document.thisform.submit();
	}
function setVals(dm,mc,code) {
	      setVal(dm,mc);
	      document.thisform.ptype.value=code;
	      document.thisform.ptypename.value=mc;
	 }
	 function subadd(url){
	    document.form2.action = url;
	    document.form2.submit();
	 }
	 function uniteTable(thistab,colLength){
	  var rn=thistab.rows.length-1;//取得行数   
	  var rowspann=0;   
	  for(j=colLength-1;j>=0;j--){//从第0列开始，合并多少列  
	  if(j == 2 || j == 1 || j == 3 || j == 4){
	    for(i=rn-1;i>0;i--){//从倒数第一行开始往上检查   
	      if(thistab.rows[i].cells[j].innerText==thistab.rows[i-1].cells[j].innerText&&thistab.rows[i].cells[j].colSpan==thistab.rows[i-1].cells[j].colSpan){//与上面一行比较，如果两行相等就合计当前行的合并行数，并删除当前行。   
		rowspann+=thistab.rows[i].cells[j].rowSpan;;
		thistab.rows[i].deleteCell(j);   
	      }else{   
		thistab.rows[i].cells[j].rowSpan+=rowspann;//如果不等就完成当前相同数据的合并。   
		rowspann=0;   
	      }   
	    }   
	    //检测无表头的表   
	    if(i==0&&rowspann>0){   
	      thistab.rows[i].cells[j].rowSpan+=rowspann;//如果不等就完成当前相同数据的合并。   
	      rowspann=0;   
	    }   
	  }   }
	}  
	 function init(){
	    uniteTable(tb,5);
	 }
	 function todel(url){
	    if(confirm("确认要删除吗？")){
	       document.thisform.target="dataframe";
	       document.thisform.action = url;
	       document.thisform.submit();
	    }
	 }
</script>
</head>

<body onload="init()">
<form name="thisform" method="post" action="invnamebom.aspx">
    <!--pageSize主要是完成分页功能，设置显示的记录的条数-->
   <input type="hidden" name="pageSize" value="$!form_pageSize">
   <input type="hidden" name="page" value="">
<table class="datatable">
  <tr class="trcolor">
    <td>产品分类</td>
   <td align="left"><input type="text" name="ptypename" value="$!form_ptypename"  readonly>
	<input type="hidden" name="ptype" value="#if($!form_ptype!='')$!form_ptype#end">
	<input type='button' name=bt class='bt1' value='选择' onclick="click_on_tree_selector($F('ptypename'),$F('dm_zzjg_tree_layer'))">
	<div class="dtree" id="dm_zzjg_tree_layer" style="position:absolute;width:300px;height:208px;visibility:Hidden;z-index:1"> 
	<table width="100%" border="1" cellspacing="0" cellpadding="0" height="100%"><tr><td>
		<IFRAME style="width:100%;height:100%" id='stree' name="swjgdm_tree_frame" marginWidth=0 marginHeight=0 src="class_tree.aspx" frameBorder=0 
			width="100%" height="100%" scrolling=auto BORDERCOLOR="#000000" ></IFRAME>
	</td></tr></table>
	</div>
	<script>
	   selector_layers[selector_layers.length]=document.all.dm_zzjg_tree_layer;
	</script>
    </td>
    <td>产品明细</td>
    <td align="left"><input type="text" name="prodname" value="$!form_prodname" /></td>
  </tr>
  <tr class="trcolor">
    <td colspan="4"><input type="button" name="b1" class="bt1" value="查  询" onclick="sub()"/>&nbsp;<input type="button" name="b1" class="bt1" value="添  加" onclick="subadd('invnamebomadd.aspx')"/>&nbsp;<input type="button" class="bt1" name="btn" value="导出excel表"onclick="javascript:method1('tb');"></td>
  </tr>
</table>
</form>
<br>
<table class="datatable" id="tb">
  <tr class="trcolor">
    <td>序号</td>
    <td>产品编码</td>
    <td>产品名称</td>
    <td>产品规格</td>
    <td>版本号</td>
    <td>原材料编码</td>
    <td>原材料名称</td>
    <td>单位用量</td>
    <td>正误差率</td>
    <td>负误差率</td>
    <td>损耗率</td>
    <td>固定损耗量</td>
    <td>参考类别</td>
    <td>创建日期</td>
    <td>操作</td>
  </tr>
  #set($i=1)
  #foreach($!m in $snbomquery)
  <tr class="trcolor">
    <td>$i</td>
    <td>$!m.YCLINVCODE</td>
    <td>$!m.YCLINVNAME</td>
    <td>$!m.YCLINVSPEC&nbsp;</td>
    <td>$!m.VERSION</td>
    <td>$!m.INVCODE</td>
    <td>$!m.INVNAME</td>
    <td>$!m.NNUM</td>
    <td>$!m.ERRU</td>
    <td>$!m.ERRD</td>
    <td>$!m.DIS</td>
    <td>$!m.DISNUM</td>
    <td>$!m.CLSNAME</td>
    <td>$!m.CREATEDATE</td>
    <td>
      #if($m.FSTATUS == 'N')
         <a href="invnamebomedit.aspx?bomid=$m.BOMID&version=$m.VERSION">修改</a>&nbsp;<a href="#" onclick="todel('invnamebomdel.aspx?bomid=$m.BOMID')">删除</a>
      #else
          &nbsp;
      #end
    </td>
  </tr>
  #set($i=$i+1)
  #end
 <tr>
        <td class="tdlabel" colspan="10">$pagecode</td>
   </tr>
</table>
<form method="post" name="form2">
</form>
<iframe name="dataframe" src="" width="0" height="0"></iframe>
</body>
</html>
<script>
function method1(tableid) {//整个表格拷贝到EXCEL中 
    var curTbl = document.getElementById(tableid); 
    var oXL = new ActiveXObject("Excel.Application"); 
    //创建AX对象excel 
    var oWB = oXL.Workbooks.Add(); 
    //获取workbook对象 
        var oSheet = oWB.ActiveSheet; 
    //激活当前sheet 
    var sel = document.body.createTextRange(); 
    sel.moveToElementText(curTbl); 
    //把表格中的内容移到TextRange中 
    sel.select(); 
    //全选TextRange中内容 
    sel.execCommand("Copy"); 
    //复制TextRange中内容  
    oSheet.Paste(); 
    //粘贴到活动的EXCEL中       
    oXL.Visible = true; 
    //设置excel可见属性 
} 
</script>