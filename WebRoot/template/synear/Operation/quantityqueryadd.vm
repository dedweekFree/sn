<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=gb2312" />
<link rel="stylesheet" type="text/css" href="../../../js/style.css">
<link rel="stylesheet" type="text/css" href="../../../js/spellCode.css">
<script  src="../../inc/js/treePicker.js" language="javascript"></script>
<script src="../../inc/js/pubjs.js"></script>
<script src="../../inc/js/preAfter.js"></script>
<link rel='StyleSheet' href='../../js/dtree.css' type='text/css' />
<title>=====</title>
<style type="text/css">
<!--
.fixedHeaderTr    
{    
position:relative;    
top:expression(this.offsetParent.scrollTop-3);    
};    
   
.mainDiv    
{    
overflow:auto;    
scrollbar-face-color:9999ff; 
height:expression((document.body.clientHeight-this.offsetTop-20>this.children[0].offsetHeight)?(this.children[0].offsetHeight+20)   :   (document.body.clientHeight-this.offsetTop-20));    
width:expression((document.body.clientWidth-this.offsetLeft));   
}
-->
</style>
<script language="javascript">
        var num1=0;
	var num2=0;
	var num3=0;
	var num4=0;
	var num5=0;
	var num6=0;
	var num7=0;
	var num8=0;
	var num9=0;
	var sysmonth = "";
	var month = "";
	function sub(){
		document.thisform.page.value =1;
		document.thisform.submit();
	}
         function setVals(dm,mc,code) {
	      setVal(dm,mc);
	      document.thisform.ptype.value=code;
	      document.thisform.ptypename.value=mc;
	 }
	  function Subtr(arg1,arg2){
	     var r1,r2,m,n;
	     try{r1=arg1.toString().split(".")[1].length}catch(e){r1=0}
	     try{r2=arg2.toString().split(".")[1].length}catch(e){r2=0}
	     m=Math.pow(10,Math.max(r1,r2));
	     n=(r1>=r2)?r1:r2;
	     return ((arg1*m-arg2*m)/m).toFixed(n);
	 } 
	 function getqichuquantity(i){
	     document.getElementById('stockquantity'+i).value=parseFloat(document.getElementById('nc_quantity'+i).value)+parseFloat(document.getElementById('plannumber'+i).value)-parseFloat(document.getElementById('stoknnumber'+i).value)-parseFloat(document.getElementById('outnnumber'+i).value)+parseFloat(document.getElementById('innumber'+i).value);
	     document.getElementById('monthnnumber'+i).value=parseFloat(document.getElementById('monthplannum'+i).value)-parseFloat(document.getElementById('stockquantity'+i).value)+parseFloat(document.getElementById('nextoutnnumber'+i).value)-parseFloat(document.getElementById('nextinnumber'+i).value);
	 }
	 function getqichuquantity1(i){
             document.getElementById('monthnnumber'+i).value=parseFloat(document.getElementById('monthplannum'+i).value)-parseFloat(document.getElementById('stockquantity'+i).value)+parseFloat(document.getElementById('nextoutnnumber'+i).value)-parseFloat(document.getElementById('nextinnumber'+i).value);
	 }
	 function tosubmit(j){
	    document.form1.B22.disabled = true;
	    var datahtml = "";
	    for(var i = 1 ; i < j; i ++){
	        datahtml +="<input type=hidden name=pk_calbody value='"+document.getElementById('pk_calbody'+i).value+"'><input type=hidden name=pk_invbasdoc value='"+document.getElementById('pk_invbasdoc'+i).value+"'><input type=hidden name=plannumber value='"+document.getElementById('plannumber'+i).value+"'><input type=hidden name=outnnumber value='"+document.getElementById('outnnumber'+i).value+"'><input type=hidden name=innumber value='"+document.getElementById('innumber'+i).value+"'><input type=hidden name=nextoutnnumber value='"+document.getElementById('nextoutnnumber'+i).value+"'><input type=hidden name=nextinnumber value='"+document.getElementById('nextinnumber'+i).value+"'><input type=hidden name=stockquantity value='"+document.getElementById('stockquantity'+i).value+"'><input type=hidden name=monthnnumber value='"+document.getElementById('monthnnumber'+i).value+"'><input type=hidden name=month value='"+document.getElementById('month'+i).value+"'><input type=hidden name=quantityid value='"+document.getElementById('quantityid'+i).value+"'>" ;
	    }
	    if(i == 1){
	        alert("没有可更新的数据");
		return false;
	    }
	    subdata.innerHTML=datahtml;
            document.form1.action="quantityquerysavedit.aspx";
            document.form1.submit();
	 }
	 function ShowDate(idText){
	      var state="dialogHeight: 300px; dialogWidth: 240px; dialogTop: 200px; dialogLeft: 300px; "+             "edge: Raised;  center: Yes; help: No; resizable: Yes; status: No;";

	     var reValue=window.showModalDialog('../../../js/date.html?OpenForm',"myDate",state);
	     if(reValue==null) 
	         ;
	     else
	         idText.value=reValue.substring(0,7);
	 
	 }
	 function addfile(){
	     window.open('paichanpfile.jsp?formname=form1&myframeurl=myframe&picurl=paper&type=custfile&tendtypeid=paichanexcel','','status=no,scrollbars=no,top=160,left=150,width=450,height=365');
	}
	function addfile2(){
	     window.open('paichanpfile2.jsp?formname=form1&myframeurl=myframe&picurl=paper&type=custfile&tendtypeid=paichanexce2','','status=no,scrollbars=no,top=160,left=150,width=450,height=365');
	}
	function downfile()
	{
	   thisform.action="downfile1.exl";
	   thisform.submit();
	}
	function downfile2()
	{
	   thisform.action="downfile2.exl";
	   thisform.submit();
	}
</script>
</head>

<body>
<form name="thisform" method="post" action="quantityqueryadd.aspx">
    <!--pageSize主要是完成分页功能，设置显示的记录的条数-->
   <input type="hidden" name="pageSize" value="$!form_pageSize">
   <input type="hidden" name="page" value="">
<table class="datatable">
  <tr class="trcolor">
    <td>产品分类</td>
   <td align="left"><input type="text" name="ptypename" value="$!form_ptypename"  readonly>
	<input type="hidden" name="ptype" value="#if($!form_ptype!='')$!form_ptype#end">
	<input type='button' name=bt class='bt1' value='选择' onclick="click_on_tree_selector($F('ptypename'),$F('dm_zzjg_tree_layer'))">
	<div class="dtree" id="dm_zzjg_tree_layer" style="position:absolute;width:300px;height:208px;visibility:Hidden;z-index:1"> 
	<table width="100%" border="1" cellspacing="0" cellpadding="0" height="100%"><tr><td>
		<IFRAME style="width:100%;height:100%" id='stree' name="swjgdm_tree_frame" marginWidth=0 marginHeight=0 src="class_tree1.aspx" frameBorder=0 
			width="100%" height="100%" scrolling=auto BORDERCOLOR="#000000" ></IFRAME>
	</td></tr></table>
	</div>
	<script>
	   selector_layers[selector_layers.length]=document.all.dm_zzjg_tree_layer;
	</script>
    </td>
    <td>产品明细</td>
    <td align="left"><input type="text" name="invname" value="$!form_invname" /></td>
  </tr>
  <tr class="trcolor">
    <td>库存组织</td>
    <td  align="left">
        <select name="bodyname">
	<option value=""></option>
	#foreach($m in $getCalbody)
	     <option value="$!m.BODYNAME" #if($form_bodyname==$m.BODYNAME) selected #end>$!m.BODYNAME</option>
	#end
	</select>
    </td>
    <td>月份</td>
    <td align="left"> <input name="month" type="text" class="login" id="month" value="$!form_month" readonly><input type="button" value="↓" onClick="ShowDate(month);" class="button" name="button23" ></td>
  </tr>
  <tr class="trcolor">
     <td colspan="4"><input type="button" name="bt11" class="bt1" value="下载模板一" onClick="downfile()">&nbsp;<input type="button" name="bt1" class="bt1" value="文件上传1" onClick="addfile()">&nbsp;<input type="button" name="bt11" class="bt1" value="下载模板二" onClick="downfile2()">&nbsp;<input type="button" name="bt2" class="bt1" value="文件上传2" onClick="addfile2()"></td>
  </tr>
  <tr class="trcolor">
    <td colspan="4"><input type="button" name="b1" class="bt1" value="查  询" onclick="sub()"/>&nbsp;</td>
  </tr>
</table>
</form>
<form name="form1" method="post" target="dataframe">
<table class="datatable" id="tb" bgcolor="#ffffff">
  <tr align="center" bgcolor="#abcdef" class="fixedHeaderTr">
    <td width="2%">序号</td>
    <td width="7%">库存组织</td>
    <td width="7%">大类</td>
    <td width="7%">规格</td>
    <td width="7%">单品</td>
    <td width="7%">单品编码</td>
    <td width="7%">（NC可用量</td>
    <td width="7%">+25-31生产计划</td>
    <td width="7%">-本月未备货量</td>
    <td width="7%">-满足当月订单调出量</td>
    <td width="7%">+满足当月订单调入量）</td>
    <td width="6%">=(-<font color="red">期初库存</font></td>
    <td width="6%">+月计划</td>
    <td width="6%">+下月调出量</td>
    <td width="6%">-下月调入量)</td>
    <td width="6%">=<font color="red">生产计划</font></td>
  </tr>
  #set($i=1)
  #foreach($!m in $snquantityfenxiquery)
  <tr class="trcolor">
    <td>$i</td>
    <td>$!m.BODYNAME<input type="hidden" name="pk_calbody$i" id="pk_calbody$i" value="$!m.PK_CALBODY"></td>
    <td>$!m.DINVNAME<input type="hidden" name="pk_invbasdoc$i" id="pk_invbasdoc$i" value="$!m.NC_PROD_PK"><input type="hidden" name="month$i" id="month$i" value="$!m.MONTH"><input type="hidden" name="quantityid$i" id="quantityid$i" value="$!m.ID"></td>
    <td>$!m.INVCLASSNAME</td>
    <td>$!m.INVNAME</td>
    <td>$!m.INVCODE</td>
    <td>$!m.NC_QUANTITY<input type="hidden" style="width:60" name="nc_quantity$i" id="nc_quantity$i" value="$!m.NC_QUANTITY"></td>
    <td><input type="text" style="width:60" name="plannumber$i" id="plannumber$i" value="$!m.PLANNUMBER" onblur="getqichuquantity($i)"  onkeyup="if(isNaN(value))execCommand('undo')" onafterpaste="if(isNaN(value))execCommand('undo')"></td>
    <td>$!m.STOKNNUMBER<input type="hidden" style="width:60" name="stoknnumber$i" id="stoknnumber$i" value="$!m.STOKNNUMBER"></td>
    <td><input type="text" style="width:60" name="outnnumber$i" id="outnnumber$i" value="$!m.OUTNNUMBER" onblur="getqichuquantity($i)"  onkeyup="if(isNaN(value))execCommand('undo')" onafterpaste="if(isNaN(value))execCommand('undo')"></td>
    <td><input type="text" style="width:60" name="innumber$i" id="innumber$i" value="$!m.INNUMBER" onblur="getqichuquantity($i)"  onkeyup="if(isNaN(value))execCommand('undo')" onafterpaste="if(isNaN(value))execCommand('undo')"></td>
    <td><input type="text" style="width:60" name="stockquantity$i" id="stockquantity$i" value="$!m.STOCKQUANTITY" readonly></td>
    <td>$!m.MONTHPLANNUM<input type="hidden" style="width:60" name="monthplannum$i" id="monthplannum$i" value="$!m.MONTHPLANNUM"></td>
    <td><input type="text" style="width:60" name="nextoutnnumber$i" id="nextoutnnumber$i" value="$!m.NEXTOUTNNUMBER" onblur="getqichuquantity1($i)"  onkeyup="if(isNaN(value))execCommand('undo')" onafterpaste="if(isNaN(value))execCommand('undo')"></td>
    <td><input type="text" style="width:60" name="nextinnumber$i" id="nextinnumber$i" value="$!m.NEXTINNUMBER" onblur="getqichuquantity1($i)" onkeyup="if(isNaN(value))execCommand('undo')" onafterpaste="if(isNaN(value))execCommand('undo')"></td>
    
    <td><input type="text" style="width:60" name="monthnnumber$i" id="monthnnumber$i" value="$!m.MONTHNNUMBER" readonly></td>
    
  </tr>
  #set($i=$i+1)
  <script language="javascript">
     sysmonth = $!m.SYSMONTH;
     month = $!m.MONTH;
  </script>
  #end
<!--  <tr height="20" class="trcolor">
       <td colspan="5" align="center">小    计</td>
       <td align="center" nowrap="nowrap">
	  <script>
	    document.write(num1);
	  </script>
	</td>
	<td align="center" nowrap="nowrap">
	  <script>
	    document.write(num2);
	  </script>
	</td>
	<td align="center" nowrap="nowrap">
	  <script>
	    document.write(num3);
	  </script>
	</td>
  </tr>-->
  <span id="subdata"></span>
  <script>
     if(sysmonth != "" && month != "" && sysmonth == month){
        document.write("<tr height=\"20\" class=\"trcolor\"><td colspan=\"16\" align=\"center\"><input type=\"button\" class=\"bt1\" value=\"提   交\" name=\"B22\" onclick=\"tosubmit($i)\"></td>");
     }
  </script>
</table>
</form>
<iframe name="dataframe" src="" width="0" height="0"></iframe>
</body>
</html>
<script>
function method1(tableid) {//整个表格拷贝到EXCEL中 
    var curTbl = document.getElementById(tableid); 
    var oXL = new ActiveXObject("Excel.Application"); 
    //创建AX对象excel 
    var oWB = oXL.Workbooks.Add(); 
    //获取workbook对象 
        var oSheet = oWB.ActiveSheet; 
    //激活当前sheet 
    var sel = document.body.createTextRange(); 
    sel.moveToElementText(curTbl); 
    //把表格中的内容移到TextRange中 
    sel.select(); 
    //全选TextRange中内容 
    sel.execCommand("Copy"); 
    //复制TextRange中内容  
    oSheet.Paste(); 
    //粘贴到活动的EXCEL中       
    oXL.Visible = true; 
    //设置excel可见属性 
} 
</script>