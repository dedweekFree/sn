<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=gb2312" />
<link rel="stylesheet" type="text/css" href="../../../js/style.css">
<link rel="stylesheet" type="text/css" href="../../../js/spellCode.css">
<script type="text/javascript" src="../../../inc/js/daojishi1.js"></script>
<title>投标信息</title>
<script language="javascript">
	function v(){
		if(document.form1.tendprice1.value == ""){
		    alert("方案一投标价格不能为空");
		    document.form1.tendprice1.focus();
		    return false;
		}else{
		    var re = /^[0-9]+.?[0-9]*$/;
			 if (!re.test(document.all.tendprice1.value))
			 {
			  alert("方案一投标价格不是数字");
			  document.all.tendprice1.select();
			  return false;
			 }
		}
		if(document.form2.pic.value == "l"){
		   if('$form_znum' == 1){
		      if(document.form2.islimitprice.value == "Y"){
		      
		      }else{
			if(parseFloat(document.form2.ppic1.value) > parseFloat(document.all.tendprice1.value)){
				alert("方案一投标价格不能低于"+document.form2.ppic1.value);
				document.all.tendprice1.select();
				return false;
			}
		      }
		   }else{
		      if(document.form2.islimitprice.value == "Y"){
                        if(parseFloat(document.all.tendprice1.value) < parseFloat(document.form1.blprice1.value)){
			     alert("方案一投标价格不能低于"+document.form1.blprice1.value);
			     document.all.tendprice1.select();
			     return false;
			 }
		      }else{
			if(parseFloat(document.form2.ppic1.value) < parseFloat(document.all.blprice1.value)){
			     if(parseFloat(document.form1.blprice1.value) > parseFloat(document.all.tendprice1.value)){
				alert("方案一投标价格不能低于"+document.form1.blprice1.value);
				document.all.tendprice1.select();
				return false;
			     }
			}else if(parseFloat(document.form2.ppic1.value) >= parseFloat(document.all.blprice1.value)){
			     if(parseFloat(document.form2.ppic1.value) > parseFloat(document.all.tendprice1.value)){
				alert("方案一投标价格不能低于"+document.form2.ppic1.value);
				document.all.tendprice1.select();
				return false;
			     }
			}
		      }
		   }
		}else{
		   if('$form_znum' == 1){
		      if(document.form2.islimitprice.value == "Y"){
		      
		      }else{
			if(parseFloat(document.form2.ppic1.value) < parseFloat(document.all.tendprice1.value)){
				alert("方案一投标价格不能高于"+document.form2.ppic1.value);
				document.all.tendprice1.select();
				return false;
			}
		      }
		   }else{
		      if(document.form2.islimitprice.value == "Y"){
		         if(parseFloat(document.all.tendprice1.value) > parseFloat(document.form1.blprice1.value)){
			     alert("方案一投标价格不能高于"+document.form1.blprice1.value);
			     document.all.tendprice1.select();
			     return false;
			 }
		      }else{
			if(parseFloat(document.form2.ppic1.value) > parseFloat(document.all.blprice1.value)){
			     if(parseFloat(document.form1.blprice1.value) < parseFloat(document.all.tendprice1.value)){
				alert("方案一投标价格不能高于"+document.form1.blprice1.value);
				document.all.tendprice1.select();
				return false;
			     }
			}else if(parseFloat(document.form2.ppic1.value) <= parseFloat(document.all.blprice1.value)){
			     if(parseFloat(document.form2.ppic1.value) < parseFloat(document.all.tendprice1.value)){
				alert("方案一投标价格不能高于"+document.form2.ppic1.value);
				document.all.tendprice1.select();
				return false;
			     }
			}
		      }
		   }
		}

		if(document.form1.tendprice2.value == ""){
		    alert("方案二投标价格不能为空");
		    document.form1.tendprice2.focus();
		    return false;
		}else{
		    var re = /^[0-9]+.?[0-9]*$/;
			 if (!re.test(document.all.tendprice2.value))
			 {
			  alert("方案二投标价格不是数字");
			  document.all.tendprice2.select();
			  return false;
			 }
		}
		if(document.form2.pic.value == "l"){
		   if('$form_znum' == 1){
		      if(document.form2.islimitprice.value == "Y"){
		      
		      }else{
			if(parseFloat(document.form2.ppic2.value) > parseFloat(document.all.tendprice2.value)){
				alert("方案二投标价格不能低于"+document.form2.ppic1.value);
				document.all.tendprice2.select();
				return false;
			}
		      }
		   }else{
		      if(document.form2.islimitprice.value == "Y"){
                        if(parseFloat(document.all.tendprice2.value) < parseFloat(document.form1.blprice2.value)){
			     alert("方案二投标价格不能低于"+document.form1.blprice2.value);
			     document.all.tendprice2.select();
			     return false;
			 }
		      }else{
			if(parseFloat(document.form2.ppic2.value) < parseFloat(document.all.blprice2.value)){
			     if(parseFloat(document.form1.blprice2.value) > parseFloat(document.all.tendprice2.value)){
				alert("方案二投标价格不能低于"+document.form1.blprice2.value);
				document.all.tendprice2.select();
				return false;
			     }
			}else if(parseFloat(document.form2.ppic2.value) >= parseFloat(document.all.blprice2.value)){
			     if(parseFloat(document.form2.ppic2.value) > parseFloat(document.all.tendprice2.value)){
				alert("方案二投标价格不能低于"+document.form2.ppic1.value);
				document.all.tendprice2.select();
				return false;
			     }
			}
		      }
		   }
		}else{
		   if('$form_znum' == 1){
		      if(document.form2.islimitprice.value == "Y"){
		      
		      }else{
			if(parseFloat(document.form2.ppic2.value) < parseFloat(document.all.tendprice2.value)){
				alert("方案二投标价格不能高于"+document.form2.ppic2.value);
				document.all.tendprice2.select();
				return false;
			}
		      }
		   }else{
		      if(document.form2.islimitprice.value == "Y"){
		         if(parseFloat(document.all.tendprice2.value) > parseFloat(document.form1.blprice2.value)){
			     alert("方案二投标价格不能高于"+document.form1.blprice2.value);
			     document.all.tendprice2.select();
			     return false;
			 }
		      }else{
			if(parseFloat(document.form2.ppic2.value) > parseFloat(document.all.blprice2.value)){
			     if(parseFloat(document.form1.blprice2.value) < parseFloat(document.all.tendprice2.value)){
				alert("方案二投标价格不能高于"+document.form1.blprice2.value);
				document.all.tendprice2.select();
				return false;
			     }
			}else if(parseFloat(document.form2.ppic2.value) <= parseFloat(document.all.blprice2.value)){
			     if(parseFloat(document.form2.ppic2.value) < parseFloat(document.all.tendprice2.value)){
				alert("方案二投标价格不能高于"+document.form2.ppic2.value);
				document.all.tendprice2.select();
				return false;
			     }
			}
		      }
		   }
		}


		if(document.form1.quantity.value == ""){
		    alert("投标数量不能为空");
		    document.form1.quantity.focus();
		    return false;
		}else{
		    if (isNaN(document.all.quantity.value)){
		        alert("投标数量不是数字!");
		        document.all.quantity.select();
		        return false;
		    }else{
			if(parseInt(document.all.quantity.value) > parseInt(document.all.quantity1.value)){
				alert("供货量不能大于招标量");
				document.all.quantity.select();
				return false;
			}
		    }
		}
	        var aaa = new Array();
		aaa = [['序号','值1','值2']
		 #set($i=0)
		#foreach ($!n in $selmaxnum)
		,['$i','$!n.PID','$!n.TENDNUM']
		#set($i=$i+1)
		#end
		]
		if(aaa.length==1){
		}else{
		        document.all.pids.value=aaa[1][1];
			document.all.tendnum2.value=aaa[1][2];
		}
		var datahtml = "";
		datahtml += "<input type='hidden' name='shebeiprice' value='"+document.form1.tendprice1.value+"'><input type='hidden' name='zhaobiaoprodesc' value='"+document.form1.tendbak.value+"'><input type='hidden' name='project' value='方案一'><input type='hidden' name='shebeiprice' value='"+document.form1.tendprice2.value+"'><input type='hidden' name='zhaobiaoprodesc' value='"+document.form1.tendbak.value+"'><input type='hidden' name='project' value='方案二'>";
		subdata.innerHTML=datahtml;
		document.getElementById('tendnum').value = document.getElementById('znum').value
		var b= new Date();
		document.all.pid.value=b.getTime();
		if(document.form1.tendnum2.value == $form_znum){
		        #if($form_znum == 1)
			    alert("普通模式每一轮只能投一次!");
			    return false;
			#else  
			    #foreach ($!m in $selpdesciscast) 
				#if($m.ISCAST == 'Y')
                                    alert("普通模式每一轮只能投一次!");
			            return false;
				#end
			    #end
			#end

		        document.all.pid.value = document.all.pids.value;
			document.form1.iscast.value='Y';
			document.form1.action = "updatetendershebeisub.aspx";
		}else{
			document.form1.iscast.value='Y';
			document.form1.action = "intendershebeisub.aspx";
		}
		form1.submit();
	}
 function upload(){
	var ReturnProductValue=showModalDialog('fileUpload.jsp','','dialogWidth:500px;dialogHeight:300px;dialogLeft:280px;dialogTop:150px;center:yes; help:yes;resizable:yes;status:yes');
 }
       function show(){
		document.all.proid.value = '$!form_proid';
		document.all.znum.value = '$!form_znum';
		if($!form_znum == 1){
		     var a = '#foreach ($!n in $seltendusertpid) $!n.USERID #end';
		     var b = '#foreach ($!n in $seltendusertpidcount) $!n.USERID #end';
		     var c = '#foreach ($!n in $querytender) $!n.ISACC #end';
		     var d = '#foreach ($!n in $querytender) $!n.ZNUM #end'.replace(/(^\s*)|(\s*$)/g,"");
		     var e = '#foreach ($!n in $querytenderuserstatus1) $!n.PROID #end';
		     if(d != $!form_znum){
			     document.location.href='tenderCon.aspx';
		     }else{
		          if(c.replace(/(^\s*)|(\s*$)/g,"") == 'Y'){
				  if(b.replace(/(^\s*)|(\s*$)/g,"") == 0){
				     if(a.replace(/(^\s*)|(\s*$)/g,"") == ""){
					document.getElementById('sp1').style.display="block";
					document.getElementById('tab').style.display="none";
				     }
				  }
			     }
		     }
		}else{
			var a = '#foreach ($!n in $querytenderuserstatus1) $!n.PROID #end';
			var b = '#foreach ($!n in $seltendusertpidcount) $!n.USERID #end';
			var c = '#foreach ($!n in $querytender) $!n.ISACC #end';
			var d = '#foreach ($!n in $querytender) $!n.ZNUM #end'.replace(/(^\s*)|(\s*$)/g,"");
			if(d != $!form_znum){
			     document.location.href='tenderCon.aspx';
		        }else{
				if(c.replace(/(^\s*)|(\s*$)/g,"") == 'Y'){
					if(b.replace(/(^\s*)|(\s*$)/g,"") == 0){
					     document.getElementById('sp1').style.display="block";
					     document.getElementById('tab').style.display="none";
					}else{
					    if(a == ""){ 
						    document.getElementById('sp').style.display="block";
						    document.getElementById('tab').style.display="none";
					    }
					}
				}else{
				     if(a == ""){ 
					    document.getElementById('sp').style.display="block";
					    document.getElementById('tab').style.display="none";
				    }
				}
			}
		}
	}
</script>
</head>

<body onload="show()">
<span id='sp1' style="display:none">
<table>
	<tr>
		<td align="center">
			没有授权，不能投标！！！！
		</td>
	</tr>
	<tr>
		<td align="center">
			<input type="button" name="returnback" class="bt1" value="返回" onclick="document.location='tenderCon.aspx'">
		</td>
	</tr>
</table>
</span>
<span id='sp' style="display:none">
<table>
	<tr>
		<td align="center">
			没有进入下一轮，不能投标！！！！
		</td>
	</tr>
	<tr>
		<td align="center">
			<input type="button" name="returnback" class="bt1" value="返回" onclick="document.location='tenderCon.aspx'">
		</td>
	</tr>
</table>
</span>
<span id='tab'>
<form name="form2" action="" method="post">
<table class="datatable">
#set($i=0)
#foreach($!m in $seltender) 
  <tr class="trcolor">
    <td colspan="4" align="left">项目内容信息</td>
  </tr>
  <tr class="trcolor">
    <td colspan="4" align="left">项目名称:$!m.PRONAME
	<input type="hidden" name="oid" id="oid" value="$!m.PROID">
	<input type="hidden" name="znum" id="znum" value="$!m.ZNUM">
	<input type="hidden" name="tdnum" id="tdnum" value="$!m.TENDNUM">
	<input type="hidden" name="pic" id="pic" value="$!m.PIC">
	<input type="hidden" name="ppic" id="ppic" value="$!m.PPIC">
	<input type="hidden" name="tendtypeid" id="tendtypeid" value="$!m.TENDTYPEID">
	<input type="hidden" name="sysdatetime" value="$!m.SYSDATETIME">
        <input type="hidden" name="ktine" value="$!m.KTINE"> 
	<input type="hidden" name="islimitprice" value="$!m.ISLIMITPRICE">
    </td>
  </tr>
  <tr class="trcolor">
    <td>项目模式:</td>
    <td>#if($!m.STATUS=='A') 普通模式
	#else 竞价模式
	#end

	#if($!m.STATUS=='B') 最新价格 
	#end
    </td>
    <td>项目状态:         
	#if($!m.PROSTATUS=='A') 正常 
    #end
    	#if($!m.PROSTATUS=='Z') 停止
    #end
	#if($!m.PROSTATUS=='S') 暂停
    #end
	#if($!m.PROSTATUS=='K') 开标
    #end</td>
  </tr>
  <tr class="trcolor">
    <td>招标开始时间:$!m.ATIME</td>
    <td><font color="red">本轮投标截止时间:$!m.KTINE</font></td>
    <td>招标结束时间:$!m.ZTIME</td>
  </tr>
  #set($i = 1)
  #foreach($!n in $zbinfodetailshebei)
  <input type="hidden" name="ppic$i" id="ppic$i" value="$!n.PPIC">
      <tr class="trcolor">
	    <td>
		#if($!m.ISLIMITPRICE == 'Y')
		    $!n.PROJECT自由报价
		#else
		    $!n.PROJECT限最#if($!m.PIC == 'h')高#else低#end招标价:<font color="red">$!n.PPIC</font>元/$!m.TYPENAME
		#end
	   </td>
	    <td colspan="2" align="left">$!n.PROJECT项目说明<textarea name="tendbak$i" cols="70"  rows="6" disabled>$!n.PRODESC</textarea>
	    </td>
      </tr>
      #set($i = $i + 1)
  #end
  <tr class="trcolor">
    <td>项目附件:</td>
    <td colspan="2">
    #if($m.PROTHER != "")
    <a href="/DownFileServlet?filepath=$!m.PROTHER">$m.PROTHER.substring($!m.PROTHER.lastIndexOf("/")).replace("/","")</a>
    #end&nbsp;
    </td>
  </tr>
  <tr class="trcolor">
    <td>招标量:$!m.TENDQUANTITY$!m.TYPENAME
    </td>
    <td colspan="2">&nbsp;
    </td>
  </tr>
</table>
</form>
<form name="form1" action="" method="post" target="dataframe">
<table class="datatable">
  <tr class="trcolor">
    <td colspan="3" align="left">投标录入(第$form_znum轮)&nbsp;&nbsp;&nbsp;&nbsp;<span id="time_area"></span><!--离本轮开标时间还有<span id="timeid"></span>-->
    <input type="hidden" name="proid" value="$form_proid">
    <input type="hidden" name="pid" value="">
    <input type="hidden" name="pids" value="">
    <input type="hidden" name="tendstatus" value="F">
    <input type="hidden" name="tendnum2" value="">
    <input type="hidden" name="iscast" value="">
    </td>
  </tr>
  <tr class="trcolor">
    <td rowspan="3">投标信息
    #foreach ($!m1 in $selmaxnum)
    <input type="hidden" name="tendnum1" value="$!m1.TENDNUM">
    #end
    <input type="hidden" name="tendnum" id="tendnum" value="">
    </td>
    <td align="left" colspan="2"><font color="red">&nbsp;&nbsp;&nbsp;方案一投标价格:</font><input type="text" name="tendprice1" value="" onkeyup="if(isNaN(value))execCommand('undo')" onafterpaste="if(isNaN(value))execCommand('undo')"/>元/$!m.TYPENAME<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;投标备注:<textarea name="tendbak" cols="58"  rows="6"></textarea>
    </td>
  </tr>
  <tr class="trcolor">
    <td align="left" colspan="2"><font color="red">&nbsp;&nbsp;&nbsp;方案二投标价格:</font><input type="text" name="tendprice2" value="" onkeyup="if(isNaN(value))execCommand('undo')" onafterpaste="if(isNaN(value))execCommand('undo')"/>元/$!m.TYPENAME<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;投标备注:<textarea name="tendbak2" cols="58"  rows="6"></textarea>
  </tr>
  <tr class="trcolor">
    <td colspan="2" align="left">&nbsp;<font color="red">最大供货量:</font><input type="text" name="quantity" value="$!m.TENDQUANTITY" onkeyup="if(isNaN(value))execCommand('undo')" onafterpaste="if(isNaN(value))execCommand('undo')"/><input type="hidden" name="quantity1" value="$!m.TENDQUANTITY"/>$!m.TYPENAME
    </td>
    <script language="javascript">
	var quantitys = '#foreach($!m4 in $querytenderuserstatus1)$!m4.QUANTITY#end';
	if(quantitys != ''){
	   document.form1.quantity.value=quantitys;
	}
    </script>
  </tr>
  <tr class="trcolor">
    <td align="left">投标附件</td>
    <td align="left">
         <input name="paper" type="text" size="40" value="" contenteditable="false"/>
	<input type="button" name="Submit22" class="bt1" value="文件上传" onClick="window.open('pfile.jsp?formname=form1&picurl=paper&type=jingbiaoinfo&tendtypeid='+document.form2.tendtypeid.value,'','status=no,scrollbars=no,top=160,left=150,width=450,height=365')">
    </td>
  </tr>
  #if($form_znum == 1)
  
  #else
     #set($i = 1)
     #foreach ($!m1 in $selectpttbpriceshebei)
     <input type="hidden" name="blprice$i" id="blprice$i" value="$!m1.TENDPRICE"> 
     #set($i = $i + 1)
      #end
  #end 
  <tr class="trcolor">
    <td colspan="3"><input type="button" class="bt1" name="button" value="提&nbsp;&nbsp;交" onclick="v()"/>
    <input type="button" name="button" class="bt1" value="返&nbsp;&nbsp;回" onclick="javascript:location.href='tenderCon.aspx'"/>
    </td>
  </tr>
  <span id="subdata"></span>
</table>
</form> #end</span>
        <div>
        <iframe name="dataframe" src="" width="0" height="0"></iframe>
    </div>
</body>
</html>
