<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=gb2312">
<title>======</title>
<script src="../../../js/sunnyfunc.js"></script>
<script>
var submitok=false;
var ChosedList=new Array();
var header=6;		//定单头的个数
var thisCol=3;	//表单体的列数
var others=0;		//表单中非表单体的控件数
var thisRow=10;     //初始行数
var submitok=false; //是否已提交
var testRow=-1;     //验证数据行号
var row=thisRow;
var submitfirst=true;
var undefined;
var seleRow=0;
   var datatb;

function addListener() {
 var inputList = document.body.getElementsByTagName("INPUT");
 if(inputList[0]) firstInput = inputList[0];
    for(var i=0;i<inputList.length;i++) {
      inputList[i].attachEvent ('onfocus', onInputFocus);
   }
}

function onInputFocus(){
     for(i=0;i<dtb.length;i++)
       tb.rows[i*2+2].style.display="none";
}



function hidetr(k) { //v6.0
    tb.rows[k*2+2].style.display="none";
}

function init()
{
    addListener();
}

function toNext(i)
{
   var elms=event.srcElement;
   key=event.keyCode;
   if(key==13)   //回车
   {
      if(elms.name=="F_pfee")
        document.form1.F_pmemo[i].focus(); 
      else if(elms.name=="F_pmemo")
      {
        if(i<(row-1))
          document.form1.elements[(i+1)*thisCol+header+1].focus();
      }
   }else{
      if(elms.name=="F_pfee"){
	   if(isNaN(elms.value))
           { 
              alert("费用必须为数字");
              return;
           } 
	   else
              allfee();
      }
   }
}

function allfee() 
{
   var pfee=0;
   var afee=0;
   for(i=0;i<row;i++){
     if(form1.F_prodpk[i].value!="" && form1.F_pfee[i].value!=""){
        if(!isNaN(form1.F_pfee[i].value)){
	  pfee=pfee+parseFloat(form1.F_pfee[i].value);
	}
     }
   }
   afee=afee+pfee;
   document.all.F_allfee.innerText=afee;
   form1.F_allfee2.value=afee;
}

function spellStr(step) 
{

   var str="";
   var spell_sql="";
   var b_sql="";
   for(i=0;i<row;i++){
        if(form1.F_pfee[i].value=="") form1.F_pfee[i].value=0;
	//if(form1.F_prodpk[i].value=="") form1.F_prodpk[i].value=i;
	if(form1.F_prodpk[i].value!="" && form1.F_pfee[i].value!=""){
	   if(isNaN(form1.F_pfee[i].value))
           { 
              alert("费用必须为数字");
              form1.F_pfee[i].focus();
              return;
           }  
	}
    }
  allfee();
  this.form1.F_step.value=step;
  this.form1.action='branchfeerequest_edit.aspx';
  this.form1.target='dataframe';
  if(!submitok)
  {
      submitok=true;
      this.form1.submit();
  }else{
      alert("请不要确认两次！");
	  return;
  }
}



</script>
<link href="../../../css.css" rel="stylesheet" type="text/css">
</head>
<body onload="init()">
<br>
<table width="700" height="30"  border="0" align="center" cellpadding="0" cellspacing="0" class="B1">
  <tr>
    <td class="f">&nbsp;&nbsp; <div align="center" class="style1">分支机构费用申请表</div></td>
  </tr>
</table>
<table width="90%"  border="0" align="center" cellpadding="0" cellspacing="0">
<tr><td height="30" class="fCopy" id="help"></td></tr>
</table>
<form name="form1" method='post' action="">  
<table width="90%" border="0" align="center" cellpadding="0" cellspacing="1" bgcolor="#999999">
#foreach($m in $getBranchFeeApply)
  <tr bgcolor="#E3E3E3" class="fCopy">
    <td height="24" nowrap><div align="right">申请时间：</div></td>
    <td width="294" height="25" nowrap>$m.APPLYMONTH <input name="F_month" type="hidden" value="$!m.APPLYMONTH"></td>
    <td width="140" height="25" nowrap><div align="right">分支机构：</div></td>
    <td width="243" height="25" nowrap>  $m.DEPTNAME
               <input name="areacode" type="hidden" value="$m.AREACODE">
   </td>
  </tr>
  <tr bgcolor="#E3E3E3" class="fCopy">
	<td width="140" height="25" nowrap><div align="right">预算费用合计：</div></td>
	<td width="243" height="25"  nowrap>
	 <div align="left">$!m.PRE_ALLFEE</div></td>
      <td width="140" height="25" nowrap><div align="right">申报费用合计：</div></td>
	<td width="243" height="25"  nowrap>
	 <div align="left" id="F_allfee">$!m.PRE_ALLFEE2</div></td>
  </tr>
  <tr bgcolor="#E3E3E3" class="fCopy">
    <td height="51%" nowrap>
    <div align="right">预算备注：</div></td>
    <td height="60" colspan="3" nowrap>$!m.REMARK    </td>
  </tr>
  <tr bgcolor="#E3E3E3" class="fCopy">
    <td height="51%" nowrap>
    <div align="right">申报备注：</div></td>
    <td height="60" colspan="3" nowrap>
    <textarea name="F_memo" cols="80" rows="2">$!m.REMARK2</textarea>
    <input name="F_id" type="hidden" value="$!m.FEEID">
    <input name="F_allfee2" type="hidden" value="$!m.PRE_ALLFEE2">
    <input name="F_step" type="hidden" value='0'>
    </td>
  </tr>
#end
</table>
<br>

<table id="tb" width="90%" border="1" align="center" cellpadding="0" cellspacing="1" bordercolor="#D4D0C8" bgcolor="#FFFFFF">
  <tr bgcolor="#E3E3E3" class="fCopy">
    <th width="8%" height="25" nowrap class="fCopy">文号</th>
    <th width="8%" height="25" nowrap class="fCopy">政策时段</th>
    <th width="8%" height="25" nowrap class="fCopy">政策内容</th>
    <th width="16%" height="25" nowrap class="fCopy">产品类别</th>
    <th width="10%" height="25" nowrap class="fCopy">预算费用金额</th>
    <th width="10%" height="25" nowrap class="fCopy">申报费用金额</th>
    <th width="38%" height="25" nowrap class="fCopy">备注</th>
  </tr>
  <tr bgcolor="#FFFFFF"  style="display:none">
     <td align="center" nowrap></td>
     <td align="center" nowrap></td>
     <td align="center" nowrap></td>
     <td align="center" nowrap><input name="F_prodpk" type="hidden" value="">	 </td>
     <td align="center" nowrap></td>
      <td align="center" nowrap><input name="F_pfee" type="text" class="login3" style="width:120" onKeyUp="toNext(0)"></td>
        <td align="center" nowrap><input name="F_pmemo" type="text" class="login3" style="width:480" onKeyUp="toNext(0)"></td>
  </tr>
  <tr><td colspan=8 style="padding:0px" ><table id="dtb"></table></td></tr>

  #set($i=1)
  #foreach($m in $getBranchFeeApply2)
  <tr bgcolor="#FFFFFF" class="fCopy">
     <td align="center" nowrap>$m.FILENO</td>
     <td align="center" nowrap>$m.DIFFTIME</td>
     <td align="center" nowrap>$m.POLICY</td>
      <td align="center" nowrap>$!m.INVCLASSNAME <input name="F_prodpk" type="hidden"value="$!m.PRODUCT_CLS_CODE">	  </td>
      <td align="center" nowrap>$m.PRE_PRODUCTFEE</td>
       <td align="center" nowrap><input name="F_pfee" type="text" value="$m.PRE_PRODUCTFEE2" class="login3" style='width:120' onKeyUp="toNext($i)"></td>
        <td align="center" nowrap><input name="F_pmemo" type="text" value="$m.REMARK2" class="login3" style='width:360' onKeyUp="toNext($i)"></td>
  </tr>
  <tr><td colspan=8 style="padding:0px" ><table id="dtb"></table></td></tr>
  #set($i=$i+1)
 #end
 <script>thisRow=$i; row=$i</script>
  </table>

   <div align="center">
  <input type="button" class="login2" value=" 保  存 " name="B22" onClick="spellStr(0);">
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<input type="button" class="login2" value=" 上  报 " name="B222" onClick="spellStr(1);">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<input type="button" class="login2" value=" 返  回 " name="B222" onClick="history.go(-1);">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<input type="button" class="login2" value=" 添加行 " name="B222" onClick="addRow();">
  </div>
</form>
<iframe name="dataframe" src="" width="0" height="0"></iframe>

</body> 
</html>      
