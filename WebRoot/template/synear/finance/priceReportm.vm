<html>
<head>
<META HTTP-EQUIV="Pragma" CONTENT="no-cache">
<META HTTP-EQUIV="Cache-Control" CONTENT="no-cache">
<META HTTP-EQUIV="Expires" CONTENT="0">
<link rel="stylesheet" type="text/css" href="../../js/style.css">
<link rel="stylesheet" type="text/css" href="../../js/spellCode.css">
<meta http-equiv="Content-Type" content="text/html; charset=GBK">
<script Language="JavaScript" src="../../../include/js/PopCalendar.js"></script>
<script Language="javascript" src="../../../include/js/public.js"></script>
<script Language="javascript" src="../../../include/js/string.js"></script>
<script  src="../../../inc/js/treePicker.js" language="javascript"></script>

<script src="../../../inc/js/pubjs.js"></script>
<script src="../../../inc/js/preAfter.js"></script>

<title>入库统计报表</title>
</head>
<script>
var dept=new Array(); 
dept=[
   ['区域主键','区域名称','大区主键']
   #foreach($m in $getSaleDept)
       ,["$!m.NC_PK","$!m.DEPTNAME","$!m.NC_FATHER_PK"]
   #end
]

function setF(departid,objid)
{
    if(departid==""){
          var obj = document.getElementById(objid);
          var length = obj.length;
          for (var j=length-1; j>0; j--)
          {
            obj.options.remove(j);
          }
    	  for(var i=1;i<dept.length;i++){   
              var oOption = document.createElement("OPTION");
              obj.options.add(oOption);
              oOption.innerText = dept[i][1];
              oOption.value = dept[i][0];
          }	  
    }else{
      var obj = document.getElementById(objid);
      var length = obj.length;
      for (var j=length-1; j>0; j--)
      {
        obj.options.remove(j);
      }
         
      for(var i=0;i<dept.length;i++){
        if(dept[i][2]==departid){
          var oOption = document.createElement("OPTION");
          obj.options.add(oOption);
          oOption.innerText = dept[i][1];
          oOption.value = dept[i][0];
        }
      }
    }
}

function setVals(dm,mc,code) {
      setVal(dm,mc);
      thisform.ptype.value=code;
      thisform.ptypename.value=mc;
}

function ShowDate(idText){
 var state="dialogHeight: 300px; dialogWidth: 240px; dialogTop: 200px; dialogLeft: 300px; "+             "edge: Raised;  center: Yes; help: No; resizable: Yes; status: No;";

 var reValue=window.showModalDialog('../../../js/date.html?OpenForm',"myDate",state);
 if(reValue==null) 
   ;
 else
   idText.value=reValue;
 
 }

function fsubmit()
{
   thisform.action="priceReport.aspx";
   thisform.page.value=1;
   thisform.submit();
}

function hsubmit()
{
   thisform.action="priceReportm.aspx";
   thisform.page.value=1;
   thisform.submit();
}

function esubmit()
{
   thisform.action="priceReportm.exl";
   thisform.submit();
}

function psubmit()
{
   if(thisform.F_dealDate.value==''){
     alert("请选择要固化的价格的月份！");
     return false;
   }
   var mon=thisform.F_dealDate.value.split("-")
   var smon=mon[0]+""+mon[1]
   #foreach($m in $getPriceMon)
       if("$!m.MON"!="" && "$!m.MON">=smon){
          alert(mon[0]+"年"+mon[1]+"月的价格可能已经固化，请与管理员联系！");
          return false;
       }
   #end
   document.all.form1.F_dealDate2.value=thisform.F_dealDate.value;
   document.all.form1.submit();
}
var dates = new Date(); 
current = dates.getYear()+"-"+(dates.getMonth()+1<10?'0'+(dates.getMonth()+1):dates.getMonth())+"-"+ dates.getDate()<10?'0'+dates.getDate():dates.getDate() ;
first = dates.getYear()+"-"+(dates.getMonth()+1<10?'0'+(dates.getMonth()+1):dates.getMonth())+"-"+'01';
last = dates.getYear()+"-"+(dates.getMonth()+1<10?'0'+(dates.getMonth()+1):dates.getMonth())+"-"+'31';

</script>
<body>	
  <form name="thisform" method="post" action="">
<table class="datatable" border="0" cellpadding="0" frame="box" cellspacing="0">

		<tr class="search"> 
                      <td class="tdlabel" width="10%">报表月度</td>
		  	<td class="tdinput" width="20%">
                         <input name="F_dealDate" type="text" class="login" id="F_dealDate" value="$!form_F_dealDate" readonly><input type="button" value="↓" onClick="ShowDate(F_dealDate);" class="button" name="button23" >
			</td>	
			
			<td class="tdlabel" width="10%">所属大区</td>
			<td class="tdinput" width="20%">
			   <select name=dq_pk onchange="javascript:setF(this.value,'areapk');"><option value=''>请选择大区</option>
                              #foreach($m in $getSysSaleBigDept)
                                     <option value="$!m.NC_PK" #if($form_dq_pk==$m.NC_PK) selected #end>$!m.DEPTNAME</option>
                              #end
                           </select>
			</td>
			
			</td>	
                </tr>
		<tr class="search"> 
			<td class="tdlabel" width="10%">产品分类</td>
			<td class="tdinput" width="20%">
				<input type="text" name="ptypename" value="$!form_ptypename"  readonly>
				<input type="hidden" name="ptype" value="$!form_ptype">
				<input type='button' name=bt class='btn' value='选择' onclick="click_on_tree_selector($F('ptypename'),$F('dm_zzjg_tree_layer'))">
				<div class="dtree" id="dm_zzjg_tree_layer" style="position:absolute;width:300px;height:208px;visibility:Hidden;z-index:1"> 
				<table width="100%" border="1" cellspacing="0" cellpadding="0" height="100%"><tr><td>
					<IFRAME style="width:100%;height:100%" name="swjgdm_tree_frame" marginWidth=0 marginHeight=0 src="../class_tree.aspx" frameBorder=0 
						width="100%" height="100%" scrolling=auto BORDERCOLOR="#000000" ></IFRAME>
				</td></tr></table>
			        </div>
			        <script>
				   selector_layers[selector_layers.length]=document.all.dm_zzjg_tree_layer;
			        </script>				
			</td>	
			<td class="tdlabel" width="10%">产品名称</td>
			<td class="tdinput" width="20%">
				<input type="text" name="pname" value="$!form_pname">		
			</td>
                </tr>
		<tr class="search"> 
			<td class="tdlabel" width="10%">所属区域</td>
			<td class="tdinput" width="20%">
			       <select name=areapk><option value=''>请选择区域</option>
                                 #foreach($m in $getSaleDept)
                                     <option value="$!m.NC_PK" #if($form_areapk==$m.NC_PK) selected #end>$!m.DEPTNAME</option>
                                 #end
                               </select>	
			       <script>
				   setF("$!form_dq_pk",'areapk');
				   thisform.areapk.value="$!form_areapk"
			       </script>
			</td>	
			<td class="tdlabel" width="10%">客户名称</td>
			<td class="tdinput" width="20%">
			    <input type="text" name="cname" value="$!form_cname">			
			</td>
                </tr>
                <tr>
			<td align="center" colspan="4">	
				<input type="button" name="search" class="bt1" value="查询" onclick="fsubmit()">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				<input type="button" name="search" class="bt1" value="按历史价格查询" onclick="hsubmit()">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				<input type="button" name="search" class="bt1" value="导出为EXCEL" onclick="esubmit()">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				<input type="button" name="search" class="bt1" value="保存价格" onclick="psubmit()">
			</td>
		</tr>		
</table>


 
    <!--pageSize主要是完成分页功能，设置显示的记录的条数-->
   <input type="hidden" name="pageSize" value="$!form_pageSize">
   <input type="hidden" name="page" value="">
<table border="0" cellspacing="0" cellpadding="0" bgcolor="#ffffff" width="98%" align="center" id="tb" 

class="datatable">
<tr height="20"  align="center" class="trtitle">
	<td nowrap="nowrap">序号</td>
	<td nowrap="nowrap">所属区域</td>
	<td nowrap="nowrap">客户名称</td>
	<td nowrap="nowrap">产品代码</td>
	<td nowrap="nowrap">产品名称</td>
	<td nowrap="nowrap">实际成本价</td>
        <td nowrap="nowrap">实际成本</td>
        <td nowrap="nowrap">生产中心结转价</td>
        <td nowrap="nowrap">生产中心结转金额</td>
	<td nowrap="nowrap">计划价</td>
	<td nowrap="nowrap">计划金额</td>
	<td nowrap="nowrap">结算价</td>
        <td nowrap="nowrap">结算金额</td>
        <td nowrap="nowrap">分支结算价</td>
        <td nowrap="nowrap">分支结算金额</td>
	<td nowrap="nowrap">销售价</td>
        <td nowrap="nowrap">销量</td>
	<td nowrap="nowrap">销售金额</td>
</tr>
    #set($i=1) 
    #foreach($m in $priceReportm)
  		<tr height="20" class="trcolor">
			<td align="center">$i</td>
			<td align="center" nowrap="nowrap">$m.DEPTNAME</td>
			<td align="center" nowrap="nowrap">$m.ORGDESC</td>
		        <td align="center" nowrap="nowrap">$m.ITEMCODE</td>
			<td align="center" nowrap="nowrap">$m.ITEMDESC</td>
			<td align="center" nowrap="nowrap">$m.COSTPRICE</td>
			<td align="center" nowrap="nowrap">$m.COSTMNY</td>
			<td align="center" nowrap="nowrap">$m.PRODPRICE</td>
                        <td align="center" nowrap="nowrap">$m.PRODMNY</td>
			<td align="center" nowrap="nowrap">$m.PLANPRICE</td>
			<td align="center" nowrap="nowrap">$m.PLANMNY</td>
			<td align="center" nowrap="nowrap">$m.ACCOUNTPRICE</td>
                        <td align="center" nowrap="nowrap">$m.ACCMNY</td>
			<td align="center" nowrap="nowrap">$m.BRANACCOUNTPRICE</td>
			<td align="center" nowrap="nowrap">$m.BRACCMNY</td>
			<td align="center" nowrap="nowrap">$m.SALEPRICE</td>
			<td align="center" nowrap="nowrap">$m.NNUMBER</td>
                        <td align="center" nowrap="nowrap">$m.NMNY</td>			
		 </tr>
		 #set($i=$i+1)
   #end  
   #if($i==1)
     <tr height="20" bgcolor="#eeeeee" class="trcolor">
     <td colspan="18"  bgcolor="#eeeeee" align="center" class="trcolor">没有相关信息</td>
     </tr>
   #end
</table>
</td></tr>
<tr><td height=5></td></tr>
<tr><td>
		<table width="100%">
   <tr >
        <td class="tdlabel td">$pagecode</td>
   </tr>
</table>
</td></tr>
</table>
</form>	
<br>
<form name="form1" method="post" action="savePriceM.aspx" target="saveframe">
  <input name="F_dealDate2" type="hidden" value="">
</form>
<iframe name="saveframe" src="about:blank" width="100%" height="0" noresize frameborder=0 framespacing=0 marginheight=0 marginwidth=0></iframe> 

</body>
</html>
