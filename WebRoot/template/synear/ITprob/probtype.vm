<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=gb2312" />
<link rel="stylesheet" type="text/css" href="../../../js/style.css">
<link rel="stylesheet" type="text/css" href="../../../js/spellCode.css">
<script src="../../inc/js/alai_win_xp.js" language="javascript"></script>
<title>=======</title>

<style type="text/css">
<!--
.gcolor {color: #FF0033}
-->
</style>
</head>

<body>
<table class="datatable">
  <tr class="trcolor">
    <td colspan="6" align="left">故障类型维护<input type="button" class="bt1" name="thisbtn" value="增加新类型" onclick="show()"></td>
  </tr>
  <tr class="trcolor">
    <td>序号</td>
    <td>编码</td>
    <td>名称</td>
    <td>状态</td>
    <td>负责人</td>
    <td>操作</td>
  </tr>
  #set($i=1)
  #foreach($m in $selbaseprobtype)
  <tr class="trcolor">
    <td>$i</td>
    <td>$!m.SENDTYPECODE</td>
    <td>$!m.SENDTYPENAME</td>
    <td>#if($!m.DR=='0') 正常 #else <span class="gcolor">停用</span> #end  </td>
    <td>#foreach($n in $selbaseuser)#if($!n.PK_SENDTYPE==$!m.PK_SENDTYPE)$!n.NAME&nbsp;#end#end</td>
    <td><a href="probtypedetail.aspx?pk_sendtype=$!m.PK_SENDTYPE">修改</a>&nbsp&nbsp; #if($!m.DR==0) <a href="updatesendtype.aspx?pk_sendtype=$!m.PK_SENDTYPE&dr=1" target="saveframe">停用</a> #else <a href="updatesendtype.aspx?pk_sendtype=$!m.PK_SENDTYPE&dr=0" target="saveframe">恢复</a>
    #end
    </td>
  </tr>
  #set($i=$i+1)
  #end
</table>
<form name="form2" action="insertprobtypedetailsub.aspx" method="post" target="saveframe">
      <table class="datatable" style="display:none" id="tb">
	<tr class="trcolor">
	   <td>故障类型名称:</td>
	   <td align="left"><input type="text" name="sendtypename" id="sendtypename" value="">
			    <input type="hidden" name="pk_sendtype" id="pk_sendtype" value="">
	   <td>
	</tr>
      </table>
</form>
<iframe name="saveframe" src="about:blank" width="100%" height="0" noresize frameborder=0 framespacing=0 marginheight=0 marginwidth=0></iframe> 
</body>
</html>
<script language='javascript'>
	function getpkValue(){
		var now = new Date(); //获取系统日期 
		var yyy ="'"+now.getYear()+"'"; //截取年		
		var yy = yyy.substring(3,5);
		var mon = now.getMonth()+1; //截取月
		var dd = now.getDate(); //截取日
		//取时间 
		var hh = now.getHours(); //截取小时 
		var mm = now.getMinutes(); //截取分钟
		var ss = now.getTime() % 60000; //获取时间，因为系统中时间是以毫秒计算的，所以秒要通过余60000得到。 
		var mil = now.getMilliseconds();//毫秒
		ss= (ss - (ss % 1000)) / 1000; //然后，将得到的毫秒数再处理成秒 
		var clock = yy; //将得到的各个部分连接成一个日期时间 
		if (parseInt(mon) < 10) mon += '0'; //字符串 
		clock += mon;  
		if (parseInt(dd) < 10) dd += '0';  
		clock += dd;
		if (parseInt(hh) < 10) hh += '0';  
		clock += hh; 
		if (parseInt(mm) < 10) mm += '0';  
		clock += mm;
		if (parseInt(ss) < 10) ss += '0';  
		clock += ss;
		if (parseInt(mil) < 10){mil += '00';
		}else if(10 <= parseInt(mil) < 100){mil += '0';}
		clock += (mil.substr(0,3));
		document.getElementById("pk_sendtype").value="PK"+clock;
	}
	function h(){
		if(document.form2.sendtypename.value==""){
			alert("请输入故障类型名称!")
			return false;
		}else{
			getpkValue();
			winMove.hide();
			form2.submit();
		}
	}
	function show(){
		winMove.show()
	}
	var b = document.getElementsByName("form2")[0];
	var btnMove = b.id;
	document.getElementById("tb").style.display="block"
	var winMove=new alai_win_xp(tb,"增加类型",400,250)
	var btn = winMove.addButton("确定","js","h()")
</script>