<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=gb2312" />
<link rel="stylesheet" type="text/css" href="../../../js/style.css">
<link rel="stylesheet" type="text/css" href="../../../js/spellCode.css">
<script src="../../inc/js/pubjs.js"></script>
<script src="../../inc/js/preAfter.js"></script>
<link rel='StyleSheet' href='../../js/dtree.css' type='text/css' />
<title>=====</title>
<style type="text/css">
<!--
.fixedHeaderTr    
{    
position:relative;    
top:expression(this.offsetParent.scrollTop-3);    
};    
   
.mainDiv    
{    
overflow:auto;    
scrollbar-face-color:9999ff; 
height:expression((document.body.clientHeight-this.offsetTop-20>this.children[0].offsetHeight)?(this.children[0].offsetHeight+20)   :   (document.body.clientHeight-this.offsetTop-20));    
width:expression((document.body.clientWidth-this.offsetLeft));   
}
-->
</style>
<script language="javascript">
        var num1=0;
	function sub(){
		document.thisform.page.value =1;
		document.thisform.submit();
	}
	 function toadd(url){
	    document.form2.action=url;
	    document.form2.submit();
	 }
	 function ShowDate(idText){
	 var state="dialogHeight: 300px; dialogWidth: 240px; dialogTop: 200px; dialogLeft: 300px; "+             "edge: Raised;  center: Yes; help: No; resizable: Yes; status: No;";
	 var reValue=window.showModalDialog('../../../js/date.html?OpenForm',"myDate",state);
	 if(reValue==null) 
		   ;
		 else
		   idText.value=reValue;
	    }

	    function todel(url){
	       if(confirm("确认要删除吗？")){
		      document.form2.target="saveframe";
		      document.form2.action=url;
		      document.form2.submit();
	      }
	    }
	    function toprint(url){
	       window.open(url,'','top='+(screen.height - 600) / 2 +',left='+(screen.width - 650) / 2 +',Toolbar=no,menubar=no,scrollbars=yes,status=yes,location=no,resizable=yes,directories=no,width=650,height=500');
	    }
	    function init(){
		  uniteTable(document.all.tb,23);//执行
		  var MyDate=new Date();
		var Year=MyDate.getFullYear();
		var MonthNum=MyDate.getMonth();
		var Month;
		if(MonthNum<9){
		    Month="0"+(MonthNum+1);
		}else{
		    Month=MonthNum+1;
		}
		var Day=MyDate.getDate();
		if(Day<=9){
		    Day="0"+Day;
		}
		var Today=Year+"-"+Month+"-"+Day;
		var v1 = "$!form_billdate1";
	        var v2 = "$!form_billdate";
		if(v1=="" && v2==""){ 
		   document.getElementById('billdate1').value=Today;
		   document.getElementById('billdate').value=Today;
		}else{
		   document.getElementById('billdate1').value=v1;
		   document.getElementById('billdate').value=v2;
		}
	   }

		var undefined;		
		function uniteTable(thistab,colLength){

		  var rn=thistab.rows.length;//取得行数   
		  var rowspann=0;   
		  for(j=colLength-1;j>=0;j--){//从第0列开始，合并多少列 
		     //if(j == 0  || j == 4 || j == 5 || j == 6 || j == 7 || j == 8 || j == 9 || j == 10 || j == 11 || j == 12 || j == 13 || j == 14 || j == 17 || j == 18 || j == 21 || j == 22 || j == 23){
		     if(j == 0  || j == 22){
			    for(i=rn-3;i>0;i--){//从倒数第一行开始往上检查   
			      if(thistab.rows[i].cells[j].innerText==thistab.rows[i-1].cells[j].innerText&&thistab.rows[i].cells[j].colSpan==thistab.rows[i-1].cells[j].colSpan){//与上面一行比较，如果两行相等就合计当前行的合并行数，并删除当前行。   
				rowspann+=thistab.rows[i].cells[j].rowSpan;;
				thistab.rows[i].deleteCell(j);   
			      }else{   
				thistab.rows[i].cells[j].rowSpan+=rowspann;//如果不等就完成当前相同数据的合并。   
				rowspann=0;   
			      }   
			    }   
			    //检测无表头的表   
			    if(i==0&&rowspann>0){   
			      thistab.rows[i].cells[j].rowSpan+=rowspann;//如果不等就完成当前相同数据的合并。   
			      rowspann=0;   
			    }   
			}
		  }   
		}  
		function openwin(url){
		    window.open(url,'','top='+(screen.height - 600) / 2 +',left='+(screen.width - 650) / 2 +',Toolbar=no,menubar=no,scrollbars=yes,status=yes,location=no,resizable=yes,directories=no,width=650,height=500');
		}
		function downfile()
		{
		   thisform.action="snsendmanagerexcel.exl";
		   thisform.submit();
		}
		function sbcheck(url){
		   if(confirm("确认要反审核吗？")){
		   thisform.target="saveframe";
		   thisform.action=url;
		   thisform.submit();
		   }
		}
</script>
</head>

<body  onload="init()">
<form name="thisform" method="post" action="snsendmanager.aspx">
    <!--pageSize主要是完成分页功能，设置显示的记录的条数-->
   <input type="hidden" name="pageSize" value="$!form_pageSize">
   <input type="hidden" name="page" value="">
<table class="datatable">
  <tr class="trcolor">
    <td nowrap>派车单号</td>
    <td align="left"><input type="text" name="ordercode" value="$!form_ordercode" style="width:120" /></td>
    <td nowrap>销售订单</td>
    <td align="left"><input type="text" name="saleorder" value="$!form_saleorder"  style="width:120" /></td>
    <td nowrap>车牌号</td>
    <td align="left"><input type="text" name="drivernum" value="$!form_drivernum"  style="width:120" /></td>
     <td nowrap>运输公司</td>
     <td align="left"><input type="text" name="sendcorpname" value="$!form_sendcorpname"  style="width:120" /></td>
  </tr>
  <tr class="trcolor">
     <td nowrap>单据开始日期</td>
     <td align="left"><input type="text" name="billdate" onclick="ShowDate(billdate)"  value="$!form_billdate"  style="width:120" /></td>
     <td nowrap>单据结束日期</td>
     <td align="left"><input type="text" name="billdate1" onclick="ShowDate(billdate1)"  value="$!form_billdate1"  style="width:120" /></td>
     <td  nowrap>是否提交</td>
    <td align="left">
       <select name="issub">
       <option value=""></option>
       <option value="Y" #if($!form_issub == 'Y')selected#end>是</option>
       <option value="N" #if($!form_issub == 'N')selected#end>否</option>
       </select>
    </td>
    <td  nowrap>是否发货</td>
    <td align="left">
       <select name="issend">
       <option value=""></option>
       <option value="1" #if($!form_issend == '1')selected#end>是</option>
       <option value="2" #if($!form_issend == '2')selected#end>否</option>
       </select>
    </td>
  </tr>
  <!--<tr class="trcolor">
     <td>预约开始日期</td>
     <td align="left"><input type="text" name="billdate3" onclick="ShowDate(billdate3)"  value="$!form_billdate3" /></td>
     <td>预约结束日期</td>
     <td align="left"><input type="text" name="billdate4" onclick="ShowDate(billdate4)"  value="$!form_billdate4" /></td>
  </tr>-->
  <tr class="trcolor">
     <td nowrap>仓库1</td>
     <td align="left">
       <select  name="storname">
       <option value=""></option>
       <option value="sinian" #if($!form_storname == 'sinian')selected#end>思念</option>
       <option value="chenzhai" #if($!form_storname == 'chenzhai')selected#end>陈砦</option>
     </td>
     <td nowrap>装车状态1</td>
    <td align="left">
       <select name="zstatu1">
         <option value=""></option>
	 <option value="1" #if($!form_zstatu1 == "1")selected#end>未到</option>
	 <option value="2" #if($!form_zstatu1 == "2")selected#end>等待</option>
	 <option value="3" #if($!form_zstatu1 == "3")selected#end>装车中</option>
	 <option value="4" #if($!form_zstatu1 == "4")selected#end>完毕</option>
       </select>
    </td>
    <td nowrap>仓库2</td>
     <td align="left">
       <select  name="storname2">
       <option value=""></option>
       <option value="sinian" #if($!form_storname2 == 'sinian')selected#end>思念</option>
       <option value="chenzhai" #if($!form_storname2 == 'chenzhai')selected#end>陈砦</option>
     </td>
     <td nowrap>装车状态2</td>
    <td align="left">
       <select name="zstatu2">
         <option value=""></option>
         <option value="1" #if($!form_zstatu2 == "1")selected#end>未到</option>
	 <option value="2" #if($!form_zstatu2 == "2")selected#end>等待</option>
	 <option value="3" #if($!form_zstatu2 == "3")selected#end>装车中</option>
	 <option value="4" #if($!form_zstatu2 == "4")selected#end>完毕</option>
       </select>
    </td>
  </tr>
  <tr class="trcolor">
    <td>客户</td>
     <td align="left"><input type="text" name="custname" value="$!form_custname"  style="width:120" /></td>
    <td nowrap>开单开始日期</td>
     <td align="left"><input type="text" name="ssdate" onclick="ShowDate(ssdate)"  value="$!form_ssdate"  style="width:120" /></td>
     <td nowrap>开单结束日期</td>
     <td align="left"><input type="text" name="ssdate1" onclick="ShowDate(ssdate1)"  value="$!form_ssdate1"  style="width:120" /></td>
    <td align="left">&nbsp;</td>
    <td align="left">&nbsp;</td>
  </tr>
  <tr class="trcolor">
    <td colspan="8"><input type="button" name="b1" class="bt1" value="查  询" onclick="sub()"/>&nbsp;#if($session_ROLES == "R2828")<input type="button" class="bt1" onclick="toadd('snsendmanageradd.aspx')" value="添  加" >&nbsp;#end<input type="button" class="bt1" name="btnss" value="导出excel表" onclick="downfile()"></td>
  </tr>
</table>
</form>

<table border="0" cellspacing="0" cellpadding="0" bgcolor="#ffffff"  align="center" id="tb" class="datatable">
<tr height="20"  align="center"  class="fixedHeaderTr" bgcolor="#abcdef" id="ftr">
    <td nowrap>派车单号</td>
    <td nowrap>订单号</td>
    <td nowrap>到货地</td>
    <td nowrap>客户名称</td>
    <td nowrap>是否拼车</td>
    <td nowrap>总量</td>
    <td nowrap>运输公司</td>
    <td nowrap>车型</td>
    <td nowrap>车牌号</td>
    <td nowrap>联系电话</td>
    <td nowrap>单据日期</td>
    <td nowrap>开单时间</td>
    <td nowrap>预约装车时间</td>
 <!--    <td nowrap>调度员预约装车时间</td>-->
    <td nowrap>第一装车地</td>
    <td nowrap>装车状态1</td>
    <td nowrap>装车状态2</td>
    <td nowrap>应发数量</td>
  <!--  <td nowrap>实发数量</td>-->
    <td nowrap>第二装车地</td>
    <td nowrap>装车状态</td>
    <td nowrap>应发数量</td>
   <!-- <td nowrap>实发数量</td>-->
    <td nowrap>添加人</td>
    <td nowrap>单据状态</td>
    <td nowrap>操作</td>
  </tr>
  #set($i=1)
  #foreach($!m in $snsendmanagerquery)
  <tr>
    <td #if($!m.SENDTIME != "") bgcolor="yellow" #end nowrap><a href="#" onclick="openwin('stockdetail.aspx?sendid=$!m.SENDID&billdate=$m.CREATEDATE&billdate1=$m.CREATEDATE')">$!m.SENDID</a></td>
    <td nowrap>$!m.ORDERCODE</td>
    <td nowrap>$!m.RECEIPTADDRESS</td>
    <td nowrap>#if($!m.CUSTNAME!="")$!m.CUSTNAME#else&nbsp;#end</td>
    <td>#if($!m.ISHECHE=='Y')是#elseif($!m.ISHECHE=='N')否#end</td>
    <td>$!m.QUANTITY</td>
    <td nowrap>#if($m.SENDCORPNAME!="")$!m.SENDCORPNAME#else&nbsp;#end</td>
    <td nowrap>#if($m.DRIVERTYPE!="")$m.DRIVERTYPE#else&nbsp;#end</td>
    <td nowrap>#if($m.DRIVERNUMBER!="")$!m.DRIVERNUMBER#else&nbsp;#end</td>
    <td nowrap>#if($m.PHONE!="")$!m.PHONE#else&nbsp;#end</td>
    <td nowrap>$!m.CREATEDATE</td>
    <td nowrap>$!m.TAUDITTIME</td>
    <td nowrap>$!m.ORDERDATE&nbsp;$!m.ORDERTIME</td>
   <!-- <td nowrap>$!m.ORDERDATE1&nbsp;$!m.ORDERTIME1</td>-->
    <td nowrap>#if($!m.ADDRESS=="chenzhai")陈砦#elseif($!m.ADDRESS=="sinian")思念#end</td>
    <td nowrap>
        #if($!m.ENDTIME1 != "")
	     <font color="green">完毕</font>
	#else
	    #if($!m.BEGINTIME1 != "")
                <font color="blue">装车中</font>
	    #else 
	        #if($!m.WAITTIME1 != "")
                    <font color="orange">等待</font>
		#else
		    <font color="red">未到</font>
		#end
	    #end
	#end
    </td>
    <td nowrap>
      #if($!m.ISHECHE=='Y')
        #if($!m.ENDTIME1 != "")
		#if($!m.ENDTIME3 != "")
		     <font color="green">完毕</font>
		#else
		    #if($!m.BEGINTIME3 != "")
			<font color="blue">装车中</font>
		    #else 
			#if($!m.WAITTIME3 != "")
			    <font color="orange">等待</font>
			#else
			    <font color="red">未到</font>
			#end
		    #end
		#end
	      #else 
		 &nbsp;
        #end
      #else 
      &nbsp;
      #end
    </td>
    <td nowrap>#if($!m.NSHOULDOUTNUM!="")$!m.NSHOULDOUTNUM#else&nbsp;#end</td>
    <!--<td nowrap>#if($!m.NOUTNUM!="")$!m.NOUTNUM#else&nbsp;#end</td>-->
    <td nowrap>#if($!m.ADDRESS1=="chenzhai")陈砦#elseif($!m.ADDRESS1=="sinian")思念#else&nbsp;#end</td>
    <td nowrap>
      #if($!m.ADDRESS1!="")
        #if($!m.ENDTIME2 != "")
	     <font color="green">完毕</font>
	#else
	    #if($!m.BEGINTIME2 != "")
                <font color="blue">装车中</font>
	    #else
	        #if($!m.WAITTIME2 != "")
                    <font color="orange">等待</font>
		#else
		    <font color="red">未到</font>
		#end
	    #end
	#end
      #else
	&nbsp;
      #end
    </td>
    <td nowrap>#if($!m.ADDRESS1!="")#if($!m.NSHOULDOUTNUM1!="")$!m.NSHOULDOUTNUM1#else&nbsp;#end#else&nbsp;#end</td>
    <!--<td nowrap>#if($!m.ADDRESS1!="")#if($!m.NOUTNUM1!="")$!m.NOUTNUM1#else&nbsp;#end#else&nbsp;#end</td>-->
    <td nowrap>$!m.MAKER</td>
    <td nowrap>#if($m.FSTATUS=='Y')提交#elseif($m.FSTATUS=='N')保存#end</td>
    <td nowrap align="left">$!m.SENDID<a href="snsendmanagerd.aspx?ordercode=$m.SENDID">明细</a>&nbsp;&nbsp;#if($session_ROLES == 'R2828')#if($m.FSTATUS=='Y')<a href="#" onclick="toprint('printsencode.jsp?ordercode=$m.SENDID')">打印</a>&nbsp;&nbsp;<a href="#" onclick="sbcheck('snsendmanagersavecheck.aspx?sendid=$m.SENDID&billdate1=$m.CREATEDATE&billdate=$m.CREATEDATE')">反审核</a>&nbsp;&nbsp;#else<a href="snsendmanagedit.aspx?ordercode=$m.SENDID">修改</a>&nbsp;&nbsp;<a href="#" onclick="todel('snsendmanagdel.aspx?sendid=$m.SENDID')">删除</a>#end#end</td>
  </tr>
  #set($i=$i+1)
  #end
  <tr>
      <td align="center">合计</td>
      #foreach($!m in $snsendmanagerquerysum)
      <td>&nbsp;</td>
      <td>&nbsp;</td>
      <td>&nbsp;</td>
      <td>&nbsp;</td>
      <td>#if($m.QUANTITY!="")$m.QUANTITY#else&nbsp;#end</td>
      <td colspan="10">&nbsp;</td>
      <td>#if($m.NSHOULDOUTNUM!="")$m.NSHOULDOUTNUM#else&nbsp;#end</td>
     <!-- <td>#if($m.NOUTNUM!="")$m.NOUTNUM#else&nbsp;#end</td>-->
      <td>&nbsp;</td>
      <td>&nbsp;</td>
      <td>#if($m.NSHOULDOUTNUM1!="")$m.NSHOULDOUTNUM1#else&nbsp;#end</td>
     <!-- <td>#if($m.NOUTNUM1!="")$m.NOUTNUM1#else&nbsp;#end</td>-->
      <td>&nbsp;</td>
      <td>&nbsp;</td>
      <td>&nbsp;</td>
      #end
  </tr>
 <tr>
        <td  colspan="23" align="left">$pagecode</td>
   </tr>
</table>
<form method="post" name="form2">
</form>
<iframe name="saveframe" src="about:blank" width="100%" height="0" noresize frameborder=0 framespacing=0 

marginheight=0 marginwidth=0></iframe>
</body>
</html>
<script>
function method1(tableid) {//整个表格拷贝到EXCEL中 
    var curTbl = document.getElementById(tableid); 
    var oXL = new ActiveXObject("Excel.Application"); 
    //创建AX对象excel 
    var oWB = oXL.Workbooks.Add(); 
    //获取workbook对象 
        var oSheet = oWB.ActiveSheet; 
    //激活当前sheet 
    var sel = document.body.createTextRange(); 
    sel.moveToElementText(curTbl); 
    //把表格中的内容移到TextRange中 
    sel.select(); 
    //全选TextRange中内容 
    sel.execCommand("Copy"); 
    //复制TextRange中内容  
    oSheet.Paste(); 
    //粘贴到活动的EXCEL中       
    oXL.Visible = true; 
    //设置excel可见属性 
} 
</script>