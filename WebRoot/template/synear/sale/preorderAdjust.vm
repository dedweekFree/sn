

<html>
<head>
<META HTTP-EQUIV="Pragma" CONTENT="no-cache">
<META HTTP-EQUIV="Cache-Control" CONTENT="no-cache">
<META HTTP-EQUIV="Expires" CONTENT="0">
<link rel="stylesheet" type="text/css" href="../../js/style.css">
<link rel="stylesheet" type="text/css" href="../../js/spellCode.css">
<meta http-equiv="Content-Type" content="text/html; charset=GBK">
<script Language="JavaScript" src="../../../include/js/PopCalendar.js"></script>
<script Language="javascript" src="../../../include/js/public.js"></script>
<script Language="javascript" src="../../../include/js/string.js"></script>
<script  src="../../../inc/js/treePicker.js" language="javascript"></script>

<script src="../../../inc/js/pubjs.js"></script>
<script src="../../../inc/js/preAfter.js"></script>
<style type="text/css">
<!--
.fixedHeaderTr    
{    
position:relative;    
top:expression(this.offsetParent.scrollTop-3);    
};    
   
.mainDiv    
{    
overflow:auto;    
scrollbar-face-color:9999ff; 
height:expression((document.body.clientHeight-this.offsetTop-20>this.children[0].offsetHeight)?(this.children[0].offsetHeight+20)   :   (document.body.clientHeight-this.offsetTop-20));    
width:expression((document.body.clientWidth-this.offsetLeft));   
}
-->
</style>
<title>客户计划完成情况</title>
</head>
<SCRIPT LANGUAGE="JavaScript">
		var dept=new Array(); 
		dept=[
		   ['区域主键','区域名称','大区主键']
			#foreach($!m in $getSysSaleDept2)
			  ,["$m.NC_PK","$m.DEPTNAME","$m.NC_FATHER_PK"]
			#end
		   ];

function setF(departid,objid)
{
    if(departid==""){
          var obj = document.getElementById(objid);
          var length = obj.length;
          for (var j=length-1; j>0; j--)
          {
            obj.options.remove(j);
          }
    	  for(var i=1;i<dept.length;i++){   
              var oOption = document.createElement("OPTION");
              obj.options.add(oOption);
              oOption.innerText = dept[i][1];
              oOption.value = dept[i][0];
          }	  
    }else{
      var obj = document.getElementById(objid);
      var length = obj.length;
      for (var j=length-1; j>0; j--)
      {
        obj.options.remove(j);
      }
         
      for(var i=1;i<dept.length;i++){
        if(dept[i][2]==departid){
          var oOption = document.createElement("OPTION");
          obj.options.add(oOption);
          oOption.innerText = dept[i][1];
          oOption.value = dept[i][0];
        }
      }
    }
}

function fsubmit()
{
        var prest='';
	for(var i=0;i<document.all.thisform.execstatus1.options.length;i++){   
		if(document.all.thisform.execstatus1.options[i].selected){
		     if(document.all.thisform.execstatus1.options[i].value!='')	prest=prest+"'"+document.all.thisform.execstatus1.options[i].value+"',";
		}
	} 
	if(prest=='')
	    document.all.thisform.pst.value='';
	else
	    document.all.thisform.pst.value=prest.substring(0,prest.length-1);
        prest='';
	for(var i=0;i<document.all.thisform.execstatus2.options.length;i++){   
		if(document.all.thisform.execstatus2.options[i].selected){
		     if(document.all.thisform.execstatus2.options[i].value!='')	prest=prest+"'"+document.all.thisform.execstatus2.options[i].value+"',";
		}
	} 
	if(prest=='')
	    document.all.thisform.ost.value='';
	else
	    document.all.thisform.ost.value=prest.substring(0,prest.length-1);
        prest='';
	for(var i=0;i<document.all.thisform.execstatus3.options.length;i++){   
		if(document.all.thisform.execstatus3.options[i].selected){
		     if(document.all.thisform.execstatus3.options[i].value!='')	prest=prest+"'"+document.all.thisform.execstatus3.options[i].value+"',";
		}
	} 
	if(prest=='')
	    document.all.thisform.sst.value='';
	else
	    document.all.thisform.sst.value=prest.substring(0,prest.length-1);
   thisform.page.value=1;
   thisform.action="preorderAdjust.aspx";
   thisform.submit();
}

function fsubmit2()
{
        var prest='';
	for(var i=0;i<document.all.thisform.execstatus1.options.length;i++){   
		if(document.all.thisform.execstatus1.options[i].selected){
		     if(document.all.thisform.execstatus1.options[i].value!='')	prest=prest+"'"+document.all.thisform.execstatus1.options[i].value+"',";
		}
	} 
	if(prest=='')
	    document.all.thisform.pst.value='';
	else
	    document.all.thisform.pst.value=prest.substring(0,prest.length-1);
        prest='';
	for(var i=0;i<document.all.thisform.execstatus2.options.length;i++){   
		if(document.all.thisform.execstatus2.options[i].selected){
		     if(document.all.thisform.execstatus2.options[i].value!='')	prest=prest+"'"+document.all.thisform.execstatus2.options[i].value+"',";
		}
	} 
	if(prest=='')
	    document.all.thisform.ost.value='';
	else
	    document.all.thisform.ost.value=prest.substring(0,prest.length-1);
        prest='';
	for(var i=0;i<document.all.thisform.execstatus3.options.length;i++){   
		if(document.all.thisform.execstatus3.options[i].selected){
		     if(document.all.thisform.execstatus3.options[i].value!='')	prest=prest+"'"+document.all.thisform.execstatus3.options[i].value+"',";
		}
	} 
	if(prest=='')
	    document.all.thisform.sst.value='';
	else
	    document.all.thisform.sst.value=prest.substring(0,prest.length-1);
   thisform.page.value=1;
   thisform.action="preorderAdjustP.aspx";
   thisform.submit();
}

function setVals(dm,mc,code) {
      setVal(dm,mc);
      thisform.ptype.value=code;
      thisform.ptypename.value=mc;
}

var dates = new Date(); 
current = dates.getYear()+"-"+(dates.getMonth()+1<10?'0'+(dates.getMonth()+1):dates.getMonth())+"-"+ dates.getDate()<10?'0'+dates.getDate():dates.getDate() ;
first = dates.getYear()+"-"+(dates.getMonth()+1<10?'0'+(dates.getMonth()+1):dates.getMonth())+"-"+'01';
last = dates.getYear()+"-"+(dates.getMonth()+1<10?'0'+(dates.getMonth()+1):dates.getMonth())+"-"+'31';

function ShowDate(idText){
 var state="dialogHeight: 300px; dialogWidth: 240px; dialogTop: 200px; dialogLeft: 300px; "+             "edge: Raised;  center: Yes; help: No; resizable: Yes; status: No;";

 var reValue=window.showModalDialog('../../../js/date.html?OpenForm',"myDate",state);
 if(reValue==null) 
   ;
 else
   idText.value=reValue;
 
 }
 function init()
{
	for(var i=0;i<document.all.thisform.execstatus1.options.length;i++){ 
		if(document.all.thisform.pst.value.indexOf(("'"+document.all.thisform.execstatus1.options[i].value+"'"))>-1){
		     document.all.thisform.execstatus1.options[i].selected=true;
		}
	} 
	for(var i=0;i<document.all.thisform.execstatus2.options.length;i++){   
		if(document.all.thisform.ost.value.indexOf(("'"+document.all.thisform.execstatus2.options[i].value+"'"))>-1){
		     document.all.thisform.execstatus2.options[i].selected=true;
		}
	} 
	for(var i=0;i<document.all.thisform.execstatus3.options.length;i++){   
		if(document.all.thisform.sst.value.indexOf(("'"+document.all.thisform.execstatus3.options[i].value+"'"))>-1){
		     document.all.thisform.execstatus3.options[i].selected=true;
		}
	} 
}
</script>
<body onload="init();">	
  <form name="thisform" method="post" action="">
   <input type="hidden" name="pageSize" value="$!form_pageSize">
   <input type="hidden" name="page" value="$!form_page">
   <input type="hidden" name="pst" value="$!form_pst">
   <input type="hidden" name="ost" value="$!form_ost">
   <input type="hidden" name="sst" value="$!form_sst">
   <table class="datatable" border="0" cellpadding="0" frame="box" cellspacing="0">
      <input type="hidden" name="first" value="1">	
      #if($session_ROLES=="R1465")
		<tr class="search"> 
                      <td class="tdlabel" width="10%">开始时间</td>
		  	<td class="tdinput" width="20%">
                         <input name="billdate" type="text" class="login" id="billdate" value="$!form_billdate" readonly><input type="button" value="↓" onClick="ShowDate(billdate);" class="button" name="button23" >
			</td>
                      <td class="tdlabel" width="10%">截止时间</td>
		  	<td class="tdinput" width="20%">
                         <input name="billdate2" type="text" class="login" id="billdate2" value="$!form_billdate2" readonly><input type="button" value="↓" onClick="ShowDate(billdate2);" class="button" name="button23" >
			</td>
                </tr>
		<tr class="search"> 
			<td class="tdlabel" width="10%">客户名称</td>
			<td class="tdinput" width="20%">
				$session_NAME	<input type="hidden" name="custcode" value="$session_USERNAME">	
			</td>
			<td class="tdlabel" width="10%"></td>
			<td class="tdinput" width="20%">
			</td>
                </tr>
		<input type="hidden" name="iscust" value="1">
      #else
                <input type="hidden" name="iscust" value="">
		<tr class="search"> 
                      <td class="tdlabel" width="10%">开始时间</td>
		  	<td class="tdinput" width="20%">
                         <input name="billdate" type="text" class="login" id="billdate" value="$!form_billdate" readonly><input type="button" value="↓" onClick="ShowDate(billdate);" class="button" name="button23" >
			</td>
                      <td class="tdlabel" width="10%">截止时间</td>
		  	<td class="tdinput" width="20%">
                         <input name="billdate2" type="text" class="login" id="billdate2" value="$!form_billdate2" readonly><input type="button" value="↓" onClick="ShowDate(billdate2);" class="button" name="button23" >
			</td>
                </tr>
	        <tr class="search"> 
			<td class="tdlabel" width="10%">所属大区</td>
			<td class="tdinput" width="20%">
				<select name=dq_pk  onchange="javascript:setF(this.value,'areapk');"><option value=''>请选择大区</option>
                              #foreach($m in $getSysSaleBigDept2)
                                     <option value="$!m.NC_PK" #if($form_dq_pk==$m.NC_PK) selected #end>$!m.DEPTNAME</option>
                              #end
                                </select>			
			</td>
			<td class="tdlabel" width="10%">所属区域</td>
			<td class="tdinput" width="20%">
				<select name=areapk><option value=''>请选择区域</option>
                              #foreach($m in $getSysSaleDept2)
                                     <option value="$!m.NC_PK">$!m.DEPTNAME</option>
                              #end
                                </select>
			</td>
                </tr>
		<script>
                    setF('$form_dq_pk','areapk');
		    document.getElementById('areapk').value='$form_areapk';
		</script>
	        <tr class="search"> 
			<td class="tdlabel" width="10%">库存组织</td>
			<td class="tdinput" width="20%">
				<select name=calbody><option value=''>请选择库存组织</option>
                                 #foreach($m in $getCalbody)
                                     <option value="$!m.PK_CALBODY" #if($form_calbody==$m.PK_CALBODY) selected #end>$!m.BODYNAME</option>
                                 #end
                                </select>			
			</td>
			<td class="tdlabel" width="10%">客户类型</td>
			<td class="tdinput" width="20%">
				<select name=custcls><option value=''>请选择客户类型</option>
                                     <option value="b" #if($form_custcls=='b') selected #end>正常客户</option>
				     <option value="小客户" #if($form_custcls=='小客户') selected #end>小客户</option>
                                </select>
			</td>
                </tr>
		<tr class="search"> 
			<td class="tdlabel" width="10%">产品分类</td>
			<td class="tdinput" width="20%">
				<input type="text" name="ptypename" value="$!form_ptypename" readonly>
				<input type="hidden" name="ptype" value="$!form_ptype">
				<input type='button' name=bt class='btn' value='选择' onclick="click_on_tree_selector($F('ptypename'),$F('dm_zzjg_tree_layer'))">
				<div class="dtree" id="dm_zzjg_tree_layer" style="position:absolute;width:300px;height:208px;visibility:Hidden;z-index:1"> 
				<table width="100%" border="1" cellspacing="0" cellpadding="0" height="100%"><tr><td>
					<IFRAME style="width:100%;height:100%" name="swjgdm_tree_frame" marginWidth=0 marginHeight=0 src="class_tree.aspx" frameBorder=0 
						width="100%" height="100%" scrolling=auto BORDERCOLOR="#000000" ></IFRAME>
				</td></tr></table>
			        </div>
			        <script>
				   selector_layers[selector_layers.length]=document.all.dm_zzjg_tree_layer;
			        </script>				
			</td>	
			<td class="tdlabel" width="10%">产品名称</td>
			<td class="tdinput" width="20%">
				<input type="text" name="pname" value="$!form_pname">		
			</td>
                </tr>
	        <tr class="search"> 
			<td class="tdlabel" width="10%">安排异常</td>
			<td class="tdinput" width="20%">
				<select name=execstatus1 multiple="true" size="4"><option value=''>请选择安排异常</option>
                                    <option value="溢车" #if($form_execstatus1=='溢车') selected #end>溢车</option>
				    <option value="缺货" #if($form_execstatus1=='缺货') selected #end>缺货</option>
				    <option value="日期缺货" #if($form_execstatus1=='日期缺货') selected #end>日期缺货</option>
                                    <option value="缺货调货" #if($form_execstatus1=='缺货调货') selected #end>缺货调货</option>
				    <option value="配车调货" #if($form_execstatus1=='配车调货') selected #end>配车调货</option>
				    <option value="缺货配车调货" #if($form_execstatus1=='缺货配车调货') selected #end>缺货配车调货</option>
				    <option value="日期调货" #if($form_execstatus1=='日期调货') selected #end>日期调货</option>
				    <option value="签报增加" #if($form_execstatus1=='签报增加') selected #end>签报增加</option>
				    <option value="签报减少" #if($form_execstatus1=='签报减少') selected #end>签报减少</option>
				    <option value="报错产品缺货" #if($form_execstatus1=='报错产品缺货') selected #end>报错产品缺货</option>
				    <option value="报错产品调货" #if($form_execstatus1=='报错产品调货') selected #end>报错产品调货</option>
                                </select>			
			</td>
			<td class="tdlabel" width="10%">备货异常</td>
			<td class="tdinput" width="20%">
				<select name=execstatus2 multiple="true" size="4"><option value=''>请选择备货异常</option>
                                    <option value="溢车" #if($form_execstatus2=='溢车') selected #end>溢车</option>
				    <option value="缺货" #if($form_execstatus2=='缺货') selected #end>缺货</option>
				    <option value="日期缺货" #if($form_execstatus2=='日期缺货') selected #end>日期缺货</option>
                                    <option value="缺货调货" #if($form_execstatus2=='缺货调货') selected #end>缺货调货</option>
				    <option value="配车调货" #if($form_execstatus2=='配车调货') selected #end>配车调货</option>
				    <option value="缺货配车调货" #if($form_execstatus2=='缺货配车调货') selected #end>缺货配车调货</option>
				    <option value="日期调货" #if($form_execstatus2=='日期调货') selected #end>日期调货</option>
				    <option value="签报增加" #if($form_execstatus2=='签报增加') selected #end>签报增加</option>
				    <option value="签报减少" #if($form_execstatus2=='签报减少') selected #end>签报减少</option>
				    <option value="报错产品缺货" #if($form_execstatus2=='报错产品缺货') selected #end>报错产品缺货</option>
				    <option value="报错产品调货" #if($form_execstatus2=='报错产品调货') selected #end>报错产品调货</option>
                                </select>
			</td>
                </tr>
	        <tr class="search"> 
			<td class="tdlabel" width="10%">发货异常</td>
			<td class="tdinput" width="20%">
				<select name=execstatus3 multiple="true" size="4"><option value=''>请选择发货异常</option>
                                    <option value="帐面缺货" #if($form_execstatus3=='帐面缺货') selected #end>帐面缺货</option>
				    <option value="缺货" #if($form_execstatus3=='日期缺货') selected #end>日期缺货</option>
				    <option value="日期缺货" #if($form_execstatus3=='出溢车') selected #end>溢车</option>
                                    <option value="开错仓库" #if($form_execstatus3=='开错仓库') selected #end>开错仓库</option>
				    <option value="质量封存" #if($form_execstatus3=='质量封存') selected #end>质量封存</option>
				    <option value="签报减少" #if($form_execstatus3=='签报减少') selected #end>签报减少</option>
                                </select>			
			</td>
			<td class="tdlabel" width="10%">客户名称</td>
			<td class="tdinput" width="20%"><input type="text" name="cname" value="$!form_cname">	
			</td>
                </tr>
                <tr>

             #end    
			
			<td align="center" colspan="4">	
				<input type="button" name="search" class="bt1" value="查询" onclick="fsubmit()">&nbsp;&nbsp;&nbsp;
				<input type="button" name="search" class="bt1" value="按产品查询" onclick="fsubmit2()">&nbsp;&nbsp;&nbsp;
			</td>
		</tr>	
		
</table>

<div style="text-align: center; background-color: #0033ff;">
                    状态说明&nbsp:&nbsp<font style="color: #009900;">&nbsp●&nbsp</font>&nbsp预订单&nbsp<font
                        style="color: #ffff00;">&nbsp●&nbsp</font>&nbsp已生成订单&nbsp<font style="color: #ff0000;">&nbsp●&nbsp</font>&nbsp已出库
                </div> 

<div class="mainDiv" id="mdiv">  
    <!--pageSize主要是完成分页功能，设置显示的记录的条数-->
<table border="0" cellspacing="0" cellpadding="0" bgcolor="#ffffff" width="98%" align="center" id="tb" class="datatable">
<tr height="20"  align="center"  class="fixedHeaderTr" bgcolor="#abcdef" id="ftr">
	<td nowrap="nowrap">序号</td>
	<td nowrap="nowrap">订单编号</td>
	<td nowrap="nowrap"></td>
	<td nowrap="nowrap">单据状态</td>
	<td nowrap="nowrap">客户名称/客户代码</td>
	<td nowrap="nowrap">产品名称/产品代码</td>
	<td nowrap="nowrap">下单时间</td>
	<td nowrap="nowrap">下单量</td>
	<td nowrap="nowrap">安排量</td>
	<td nowrap="nowrap">安排异常</td>
	<td nowrap="nowrap">备货量</td>
	<td nowrap="nowrap">备货异常</td>
	<td nowrap="nowrap">发货量</td>
	<td nowrap="nowrap">发货异常</td>
        
</tr>
 #if($form_first=="1")
    #set($i=1) 
    #foreach($m in $getPreOrderAdjust)
  		<tr height="20" class="trcolor">
			<td align="center">$i</td>
			<td align="center" nowrap="nowrap">$m.VRECEIPTCODE</td>
			<td nowrap="nowrap">
			  #if($m.ORDERNUM=="0")
			    <font style="color: #009900;">&nbsp●&nbsp</font>
			  #else
				  #if($m.SALENUM=="0")
				    <font style="color: #ffff00;">&nbsp●&nbsp</font>
				  #else
				    <font style="color: #ff0000;">&nbsp●&nbsp</font>
				  #end
			  #end

			</td>
			<td align="center" nowrap="nowrap">
			   #if($m.FSTATUS=="1") 自由/$!m.FSTATUS #end
			   #if($m.FSTATUS=="2") 审批/$!m.FSTATUS #end
			   #if($m.FSTATUS=="3") 冻结/$!m.FSTATUS #end
			   #if($m.FSTATUS=="4") 关闭/$!m.FSTATUS #end
			   #if($m.FSTATUS=="5") 作废/$!m.FSTATUS #end
			   #if($m.FSTATUS=="7") 提交/$!m.FSTATUS #end
                        </td>
		        <td align="center" nowrap="nowrap">$m.ORGDESC/$m.ORGCODE</td>
			<td align="center" nowrap="nowrap">$m.ITEMDESC/$m.ITEMCODE</td>
			<td align="center" nowrap="nowrap">$m.DBILLDATE</td>
			<td align="center" nowrap="nowrap">$m.PREORDERNUM</td>
			<td align="center" nowrap="nowrap">$m.ARRNUM</td>
			<td align="center" nowrap="nowrap">$m.VDEF6 &nbsp</td>
		        <td align="center" nowrap="nowrap">$m.ORDERNUM</td>
			<td align="center" nowrap="nowrap">$m.ORDERST &nbsp</td>
			<td align="center" nowrap="nowrap">$m.SALENUM</td>
			<td align="center" nowrap="nowrap">$m.SALEST &nbsp</td>

		 </tr>
		 #set($i=$i+1)
   #end  
   #if($i==1)
     <tr height="20" bgcolor="#eeeeee" class="trcolor">
     <td colspan="8"  bgcolor="#eeeeee" align="center" class="trcolor">没有相关信息</td>
     </tr>
   #end
#else
     <tr height="20" bgcolor="#eeeeee" class="trcolor">
     <td colspan="8"  bgcolor="#eeeeee" align="center" class="trcolor">请选择条件查询</td>
     </tr>
#end
</table>
</div>
<table width="100%">
   <tr >
        <td class="tdlabel td">$pagecode</td>
   </tr>
</table>
</form>	
</body>
</html>
