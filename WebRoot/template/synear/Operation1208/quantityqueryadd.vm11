<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=gb2312" />
<link rel="stylesheet" type="text/css" href="../../../js/style.css">
<link rel="stylesheet" type="text/css" href="../../../js/spellCode.css">
<script  src="../../inc/js/treePicker.js" language="javascript"></script>
<script src="../../inc/js/pubjs.js"></script>
<script src="../../inc/js/preAfter.js"></script>
<link rel='StyleSheet' href='../../js/dtree.css' type='text/css' />
<title>=====</title>
<style type="text/css">
<!--
.fixedHeaderTr    
{    
position:relative;    
top:expression(this.offsetParent.scrollTop-3);    
};    
   
.mainDiv    
{    
overflow:auto;    
scrollbar-face-color:9999ff; 
height:expression((document.body.clientHeight-this.offsetTop-20>this.children[0].offsetHeight)?(this.children[0].offsetHeight+20)   :   (document.body.clientHeight-this.offsetTop-20));    
width:expression((document.body.clientWidth-this.offsetLeft));   
}
-->
</style>
<script language="javascript">
         var bData1=new Array(); 
bData1=[
      ['产品代码0','产品名称1','大类2','NC可用量3','25-31生产计划量4','本月未备货量5','状态6','0','产品主键8','库存组织主键9','满足当月订单调出量10','调入量11','下月调出量12','下月调入量13','期初库存14','库存满足当月销量计划15','月计划16','id主键17']
 #set($i=1)
 #foreach($m in $snquantityfenxiqueryall)
      ,['$m.INVCODE','$m.INVNAME','$m.DINVNAME',$m.NC_QUANTITY,'0','0','N','$i','$m.NC_PROD_PK','$m.PK_CALBODY','$m.OUTNNUMBER','$m.INNUMBER','$m.NEXTOUTNNUMBER','$m.NEXTINNUMBER','$m.STOCKQUANTITY','$m.MONTHNNUMBER','$m.MONTHPLANNUM','$m.ID']
   #set($i=$i+1)
 #end
]

var pageSize=50;
var pageno=0;
var rdata=new Array();
rdata=bData1;

function toPage2() 
{
  var element=document.all.pgs;
  if(element.value.search("^-?\\d+(\\.\\d+)?$")!=0){
     alert("页数必须为大于1且小于"+Math.ceil((rdata.length-1)/pageSize)+"的整数!");
     element.focus();
     return false;
  }
  if(element.value<1){
     alert("页数必须为大于1且小于"+Math.ceil((rdata.length-1)/pageSize)+"的整数!");
     element.focus();
     return false;
  }
  if(element.value>Math.ceil((rdata.length-1)/pageSize)){
     alert("页数必须为大于1且小于"+Math.ceil((rdata.length-1)/pageSize)+"的整数!");
     element.focus();
     return false;
  }
  toPage(element.value) 
}


function toPage(page) 
{
try{
  savepage(pageno);
  pageno=page;
  for(var i=table6.rows.length;i>1;i--) table6.deleteRow(i-1);
  for(var i=1;i<=pageSize;i++){
    if(((page-1)*pageSize+i)<rdata.length){
  	  var row=table6.insertRow()
	  if(rdata[(page-1)*pageSize+i][6]=='Y') row.insertCell().innerHTML="<input type=checkbox name=checkbox value='checkbox' checked>";
	  else{
	     row.insertCell().innerHTML="<input type=checkbox name=checkbox value='checkbox'>";
	  }
    //       ['产品代码0','产品名称1','产品规格2','库存量3','应发数量4','出库数量5','状态6','0','产品主键8','库位9','批次号10','FSTYLE11','nobillno12','DTVALUE13','UVALUE14','bxunitcode15']
	  row.insertCell().innerText=rdata[(page-1)*pageSize+i][0]
	  row.insertCell().innerText=rdata[(page-1)*pageSize+i][1];
	  row.insertCell().innerText=rdata[(page-1)*pageSize+i][2]
	  row.insertCell().innerText=rdata[(page-1)*pageSize+i][3]
	  for(var j=5;j<6;j++){
	     with (row.insertCell())
             {
	       innerHTML=rdata[(page-1)*pageSize+i][j];
	       if(rdata[(page-1)*pageSize+i][j]!=rdata[(page-1)*pageSize+i][j+5]){
	         //width='10%'
		 //attachEvent("onclick",setEditBox); 
		 className="dirty-cell";
	       }
	     }
	 }
	 row.insertCell().innerHTML=rdata[(page-1)*pageSize+i][11];
	 row.insertCell().innerHTML=rdata[(page-1)*pageSize+i][10]; 
	 SetRowCanEdit(row);
    }
 }
 var apg=Math.ceil((rdata.length-1)/pageSize);
 var npg=parseInt(page)+1;
 var ppg=parseInt(page)-1;
 var pagetext="共<font color=red>"+apg+"</font>页<font color=red>"+(rdata.length-1)+"</font>条记录，每页显示<font color=red>"+pageSize+"</font>条，目前是第<font color=red>"+page+"</font>页&nbsp;&nbsp;&nbsp;&nbsp;";
 if(page<apg) pagetext+="<a style='cursor:hand' onclick='toPage2()'><font color=blue>转到</font></a><input type=text id=pgs size=3 value="+npg+">&nbsp;&nbsp;&nbsp;&nbsp;";
 else  pagetext+="<a style='cursor:hand' onclick='toPage2()'><font color=blue>转到</font></a><input type=text id=pgs size=3 value=1>&nbsp;&nbsp;&nbsp;&nbsp;";
 if(page>1) pagetext+="<a style='cursor:hand' onclick='toPage(1)'><font color=blue>首页</font></a>&nbsp;&nbsp;<a style='cursor:hand' onclick='toPage("+ppg+")'><font color=blue>上一页</font></a>&nbsp;&nbsp;"
 if(page<apg) pagetext+="<a style='cursor:hand' onclick='toPage("+npg+")'><font color=blue>下一页</font></a>&nbsp;&nbsp;<a style='cursor:hand' onclick='toPage("+apg+")'><font color=blue>尾页</font></a>&nbsp;&nbsp;"
 
 document.all.pg.innerHTML=pagetext;
 }catch(e){
   alert(e.description)
 }
}

	 function getqichuquantity(i){
	     document.getElementById('stockquantity'+i).value=parseFloat(document.getElementById('nc_quantity'+i).value)+parseFloat(document.getElementById('plannumber'+i).value)-parseFloat(document.getElementById('stoknnumber'+i).value)-parseFloat(document.getElementById('outnnumber'+i).value)+parseFloat(document.getElementById('innumber'+i).value);
	     document.getElementById('monthnnumber'+i).value=parseFloat(document.getElementById('monthplannum'+i).value)-parseFloat(document.getElementById('nc_quantity'+i).value)-parseFloat(document.getElementById('plannumber'+i).value)+parseFloat(document.getElementById('stoknnumber'+i).value)+parseFloat(document.getElementById('outnnumber'+i).value)-parseFloat(document.getElementById('innumber'+i).value)+document.getElementById('nextoutnnumber'+i).value-document.getElementById('nextinnumber'+i).value;
	 }
	 function getqichuquantity1(i){
             document.getElementById('monthnnumber'+i).value=parseFloat(document.getElementById('monthplannum'+i).value)-document.getElementById('stockquantity'+i).value+document.getElementById('nextoutnnumber'+i).value-document.getElementById('nextinnumber'+i).value;
	 }
	 function tosubmit(j){
	    var datahtml = "";
	    for(var i = 1 ; i < j; i ++){
	        datahtml +="<input type=hidden name=pk_calbody value='"+document.getElementById('pk_calbody'+i).value+"'><input type=hidden name=pk_invbasdoc value='"+document.getElementById('pk_invbasdoc'+i).value+"'><input type=hidden name=plannumber value='"+document.getElementById('plannumber'+i).value+"'><input type=hidden name=outnnumber value='"+document.getElementById('outnnumber'+i).value+"'><input type=hidden name=innumber value='"+document.getElementById('innumber'+i).value+"'><input type=hidden name=nextoutnnumber value='"+document.getElementById('nextoutnnumber'+i).value+"'><input type=hidden name=nextinnumber value='"+document.getElementById('nextinnumber'+i).value+"'><input type=hidden name=stockquantity value='"+document.getElementById('stockquantity'+i).value+"'><input type=hidden name=monthnnumber value='"+document.getElementById('monthnnumber'+i).value+"'><input type=hidden name=month value='"+document.getElementById('month'+i).value+"'>" ;
	    }
	    if(i == 1){
	        alert("没有可更新的数据");
		return false;
	    }
	    subdata.innerHTML=datahtml;
            document.form1.action="quantityquerysavedit.aspx";
            document.form1.submit();
	 }
	 function ShowDate(idText){
	      var state="dialogHeight: 300px; dialogWidth: 240px; dialogTop: 200px; dialogLeft: 300px; "+             "edge: Raised;  center: Yes; help: No; resizable: Yes; status: No;";

	     var reValue=window.showModalDialog('../../../js/date.html?OpenForm',"myDate",state);
	     if(reValue==null) 
	         ;
	     else
	         idText.value=reValue.substring(0,7);
	 
	 }
</script>
</head>

<body>
<form name="thisform" method="post" action="quantityquery.aspx">
    <!--pageSize主要是完成分页功能，设置显示的记录的条数-->
   <input type="hidden" name="pageSize" value="$!form_pageSize">
   <input type="hidden" name="page" value="">
<table class="datatable">
  <tr class="trcolor">
    <td>产品分类</td>
   <td align="left"><input type="text" name="ptypename" value="$!form_ptypename"  readonly>
	<input type="hidden" name="ptype" value="#if($!form_ptype!='')$!form_ptype#end">
	<input type='button' name=bt class='bt1' value='选择' onclick="click_on_tree_selector($F('ptypename'),$F('dm_zzjg_tree_layer'))">
	<div class="dtree" id="dm_zzjg_tree_layer" style="position:absolute;width:300px;height:208px;visibility:Hidden;z-index:1"> 
	<table width="100%" border="1" cellspacing="0" cellpadding="0" height="100%"><tr><td>
		<IFRAME style="width:100%;height:100%" id='stree' name="swjgdm_tree_frame" marginWidth=0 marginHeight=0 src="class_tree1.aspx" frameBorder=0 
			width="100%" height="100%" scrolling=auto BORDERCOLOR="#000000" ></IFRAME>
	</td></tr></table>
	</div>
	<script>
	   selector_layers[selector_layers.length]=document.all.dm_zzjg_tree_layer;
	</script>
    </td>
    <td>产品明细</td>
    <td align="left"><input type="text" name="invname" value="$!form_invname" /></td>
  </tr>
  <tr class="trcolor">
    <td>库存组织</td>
    <td  align="left">
        <select name="bodyname">
	<option value=""></option>
	#foreach($m in $getCalbody)
	     <option value="$!m.BODYNAME" #if($form_bodyname==$m.BODYNAME) selected #end>$!m.BODYNAME</option>
	#end
	</select>
    </td>
    <td>月份</td>
    <td align="left"> <input name="month" type="text" class="login" id="month" value="$!form_month" readonly><input type="button" value="↓" onClick="ShowDate(month);" class="button" name="button23" ></td>
  </tr>
  <tr class="trcolor">
    
  </tr>
  <tr class="trcolor">
    <td colspan="4"><input type="button" name="b1" class="bt1" value="查  询" onclick="sub()"/>&nbsp;<input type="button" class="bt1" name="btn" value="导出excel表"onclick="javascript:method1('tb');"></td>
  </tr>
</table>
</form>
<form name="form1" method="post" target="dataframe">
<table class="datatable" id="tb" bgcolor="#ffffff">
  <tr align="center" bgcolor="#abcdef">  <!--class="fixedHeaderTr" -->
    <td width="2%">序号</td>
    <td width="7%">库存组织</td>
    <td width="7%">大类</td>
    <td width="7%">规格</td>
    <td width="7%">单品</td>
    <td width="7%">NC可用量</td>
    <td width="7%">25-31生产计划</td>
    <td width="7%">本月未备货量</td>
    <td width="7%">满足当月订单调出量</td>
    <td width="7%">满足当月订单调入量</td>
    <td width="7%">下月调出量</td>
    <td width="7%">下月调入量</td>
    <td width="7%">期初库存</td>
    <td width="7%">库存满足当月销量计划</td>
    <td width="7%">月计划</td>
  </tr>
  
</table>
</form>
<iframe name="dataframe" src="" width="0" height="0"></iframe>
</body>
</html>