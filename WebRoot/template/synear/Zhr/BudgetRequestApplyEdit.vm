<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=gb2312">
    <title>======</title>
    <link rel="stylesheet" type="text/css" href="../../../js/ZhrCss.css">

    <script src="../../../js/sunnyfunc.js"></script>

    <script>
var submitok=false;
var ChosedList=new Array();
var header=10;		//定单头的个数
var thisCol=4;	//表单体的列数
var others=0;		//表单中非表单体的控件数
var thisRow=10;     //初始行数
var submitok=false; //是否已提交
var testRow=-1;     //验证数据行号
var row=thisRow;
var submitfirst=true;
var undefined;
var seleRow=0;
var datatb;


function init()
{
    //addListener();
      allfee();
      allfee2();
}

function toNext(i)
{
   var elms=event.srcElement;
   key=event.keyCode;
   if(key==13)   //回车
   {
      if(elms.name=="F_pfee")
        document.form1.F_pmemo[i].focus(); 
      else if(elms.name=="F_pmemo")
      {
        if(i<(row-1))
          document.form1.F_pfee[i+1].focus(); 
      }
   }else{
      if(elms.name=="F_pfee"){
	   if(isNaN(elms.value))
           { 
              alert("费用必须为数字");
              return;
           } 
	   else
              allfee();
	      allfee2();
      }
   }
}

function allfee() 
{
   var pfee=0;
   var afee=0;
   if(row>1){
	   for(i=0;i<row;i++){
	     if(form1.F_pfee[i].value!=""){
		if(!isNaN(form1.F_pfee[i].value)){
		  pfee=pfee+parseFloat(form1.F_pfee[i].value);
		}
	     }
	   }
   }else{
	 if(form1.F_pfee.value!=""){
		if(!isNaN(form1.F_pfee.value)){
		  pfee=pfee+parseFloat(form1.F_pfee.value);
		}
	     }
   }
   afee=afee+pfee;
   document.all.F_allfee.innerText=afee;
   form1.F_allfee2.value=afee;
}

function allfee2() 
{
   var pfee=0;
   var afee=0;
   if(row>1){
   for(i=0;i<row;i++){
	     if(form1.F_pfee[i].value!=""){
		if(!isNaN(form1.F_pfee[i].value)&&(form1.F_deptsubject[i].value=="20091014132016001"||form1.F_deptsubject[i].value=="20091014132016002")){
		  pfee=pfee+parseFloat(form1.F_pfee[i].value);
		}
	     }
	   }
   }else{
	if(form1.F_pfee.value!=""){
		if(!isNaN(form1.F_pfee.value)&&(form1.F_deptsubject.value=="20091014132016001"||form1.F_deptsubject.value=="20091014132016002")){
		  pfee=pfee+parseFloat(form1.F_pfee.value);
		}
	     }
   }
   document.all.F_allprodfee.innerText=pfee;
   form1.F_prodfee.value=pfee;
}

function spellStr() 
{

   var str="";
   var spell_sql="";
    if(this.form1.F_salefee.value==""){
       alert("销售目标不能为空！！！");
       return false;
    }
    if(this.form1.F_recevalfee.value==""){
       this.form1.F_recevalfee.value=0;
    }
    if(this.form1.F_ortherfee.value==""){
       this.form1.F_ortherfee.value=0;
    }
   var b_sql="";
   for(i=0;i<row;i++){
	   if(row>1){
		if(form1.F_pfee[i].value=="") form1.F_pfee[i].value=0;
		if(form1.F_prodpk[i].value=="") form1.F_prodpk[i].value=i;
		if(form1.F_prodpk[i].value!="" && form1.F_pfee[i].value!=""){
		   if(isNaN(form1.F_pfee[i].value))
		   { 
		      alert("费用必须为数字");
		      form1.F_pfee[i].focus();
		      return;
		   }  
		   b_sql="have";
		}
	}else{
		if(form1.F_pfee.value=="") form1.F_pfee.value=0;
		if(form1.F_prodpk.value=="") form1.F_prodpk.value=i;
		if(form1.F_prodpk.value!="" && form1.F_pfee.value!=""){
		   if(isNaN(form1.F_pfee.value))
		   { 
		      alert("费用必须为数字");
		      form1.F_pfee.focus();
		      return;
		   }  
		   b_sql="have";
		}
	}
    }
  allfee();
  this.form1.action='BudgetRequestApplyEditSave.aspx';
  this.form1.target='dataframe';
  if(!submitok)
  {
      submitok=true;
      this.form1.submit();
  }else{
      alert("请不要确认两次！");
	  return;
  }
}

    </script>

    <link href="../../../css.css" rel="stylesheet" type="text/css">
</head>
<body onload="init()">
    <div class="Main">
        <div class="CaptionTxt">
            客户费用申请表</div>
        <%--<table width="90%"  border="0" align="center" cellpadding="0" cellspacing="0">
<tr><td height="30"  id="help"></td></tr>
</table>--%>
        <form name="form1" method='post' action="">
        <table class="List" width="100%">
        <tr>
			<th colspan='6'>
			客户费用申请表
			</th>
        </tr>
            #foreach($m in $ZhrGetFeeRequestHead)
            <tr bgcolor="#E3E3E3">
                <td height="24">
                    <div align="right">
                        申请时间：</div>
                </td>
                <td>
                    $m.APPLYMONTH
                    <input name="F_month" type="hidden" value="$!m.APPLYMONTH">
                </td>
                <td>
                    <div align="right">
                        客户名称：</div>
                </td>
                <td colspan="3">
                    $!m.CUSTNAME
                    <input name="F_custpk" type="hidden" class="login" id="F_custpk" value="$form_custpk">
                </td>
            </tr>
            <tr bgcolor="#E3E3E3">
                <td>
                    <div align="right">
                        预算销售目标：</div>
                </td>
                <td>
                    <div align="left">
                        $!m.PRE_SALEAIM(元)
                    </div>
                </td>
                <td>
                    <div align="right">
                        预算应收目标：</div>
                </td>
                <td>
                    <div align="left">
                        $!m.PRE_RECEVALAIM(元)
                    </div>
                </td>
                <td>
                    <div align="right">
                        预算其它目标：</div>
                </td>
                <td>
                    <div align="left">
                        $!m.PRE_ORTHERAIM(元)
                    </div>
                </td>
            </tr>
            <tr bgcolor="#E3E3E3">
                <td>
                    <div align="right">
                        预算产品费用：</div>
                </td>
                <td>
                    <div align="left">
                        $!m.PRE_PRODFEE(元)</div>
                </td>
                <td>
                    <div align="right">
                        预算费用合计：</div>
                </td>
                <td colspan="3">
                    <div align="left">
                        $!m.PRE_ALLFEE(元)</div>
                </td>
            </tr>
            <tr bgcolor="#E3E3E3">
                <td height="51%">
                    <div align="right">
                        预算备注：</div>
                </td>
                <td height="60" colspan="5">
                    $!m.REMARK
                </td>
            </tr>
            <tr bgcolor="#E3E3E3">
                <td height="51%">
                    <div align="right">
                        本期回款：</div>
                </td>
                <td height="60" colspan="5">
                    $!m.CASH(元)
                </td>
            </tr>
            <tr bgcolor="#E3E3E3">
                <td>
                    <div align="right">
                        申报销售目标：</div>
                </td>
                <td>
                    <div align="left">
                        <input name="F_salefee" type="text" class="login" id="F_salefee" style="width: 100"
                            value="$!m.PRE_SALEAIM2" onkeyup="allfee()">(元)*
                    </div>
                </td>
                <td>
                    <div align="right">
                        申报应收目标：</div>
                </td>
                <td>
                    <div align="left">
                        <input name="F_recevalfee" type="text" class="login" id="F_recevalfee" style="width: 100"
                            value="$!m.PRE_RECEVALAIM2" onkeyup="allfee()">(元)
                    </div>
                </td>
                <td>
                    <div align="right">
                        申报其它目标：</div>
                </td>
                <td>
                    <div align="left">
                        <input name="F_ortherfee" type="text" class="login" id="F_ortherfee" style="width: 100"
                            value="$!m.PRE_ORTHERAIM2" onkeyup="allfee()">(元)
                    </div>
                </td>
            </tr>
            <tr bgcolor="#E3E3E3">
                <td>
                    <div align="right">
                        申报产品费用：</div>
                </td>
                <td>
                    <div align="left" id="F_allprodfee">
                        $!m.PRE_PRODFEE2(元)</div>
                </td>
                <td>
                    <div align="right">
                        申报费用合计：</div>
                </td>
                <td colspan="3">
                    <div align="left" id="F_allfee">
                        $!m.PRE_ALLFEE2(元)</div>
                </td>
            </tr>
            <tr bgcolor="#E3E3E3">
                <td height="51%">
                    <div align="right">
                        申报说明：</div>
                </td>
                <td height="60" colspan="5">
                    <textarea name="F_memo" cols="80" rows="2" class='FontInfo' readonly="true">1、申报产品费用时请选择相关"产品类别"中的产品内容；
2、申报终端费用时"产品类别"则无需选择，直接在费用说明直接填列.</textarea>
                    <input name="F_id" type="hidden" value="$!m.FEEID">
                    <input name="F_prodfee" type="hidden" value="$!m.PRE_PRODFEE2"><input name="F_allfee2"
                        type="hidden" value="$!m.PRE_ALLFEE2">
                </td>
            </tr>
            #end #foreach($mm in $getCustomerDept)
            <input name="areacode" type="hidden" value="$mm.DEPTCODE">
            #end
        </table>
        <table id="tb" class="List"  width="100%">
            <tr bgcolor="#E3E3E3">
                <th style='width:100px;'>
                    产品类别
                </th>
                <th style='width:50px;'>
                    销售额
                </th>
                <th>
                    部门名称
                </th>
                <th style='width:110px;'>
                    承担部门
                </th>
                <th style='width:150px;'>
                    费用科目
                </th>
                <th>
                    预算金额
                </th>
                <th style='width:130px;'>
                    申报金额
                </th>
                <th>
                    备注
                </th>
            </tr>
            #set($i=0) 
	    #foreach($m in $ZhrGetFeeRequestBody)
            <tr bgcolor="#FFFFFF">
                <td align="center">
                    $!m.INVCLASSNAME
                    <input name="F_prodpk" type="hidden" value="$!m.PRODUCT_CLS_CODE">
                </td>
                <td align="center">
                    $m.NMNY
                </td>
                <td align="center">
                    <input name="F_deptcode" type="hidden" value="$m.AREACODE">
                    $m.DEPTNAME
                </td>
                <td align="center">
                    <select name="F_deptbear">
                        #foreach($n in $ZhrGetTypeFeiYongChengDan)
                        <option value="$n.ID" #if($n.ID==$m.DEPETBEAR) selected #end>$n.TYPENAME</option>
                        #end
                    </select>
                </td>
                <td align="center">
                    <select name="F_deptsubject" onchange="allfee2()">
                        #foreach($n in $ZhrGetTypeFeiYongKeMu)
                        <option value="$n.ID" #if($n.ID==$m.DEPETSUBJECT) selected #end>$n.TYPENAME</option>
                        #end
                    </select>
                </td>
                <td align="center">
                    $m.PRE_PRODUCTFEE
                </td>
                <td align="center">
                    <input name="F_pfee" value="$m.PRE_PRODUCTFEE" type="text" class="login3" style="width: 120"
                        onkeyup="toNext($i)">(元)
                </td>
                <td align="center">
                    <input name="F_pmemo" value="$m.REMARK" type="text" class="login3" style="width: 100%"
                        onkeyup="toNext($i)">
                </td>
            </tr>
            <script>thisRow=$i+1; row=$i+1</script>
            #set($i=$i+1) 
	    #end
        </table>
        <div align="center">
            <input type="button" class="login2" value=" 保  存 " name="B22" onclick="spellStr();">
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            <input type="button" class="login2" value=" 返  回 " name="B222" onclick="history.go(-1);">
        </div>
        </form>
        <iframe name="dataframe" src="" width="0" height="0"></iframe>
    </div>
</body>
</html>
