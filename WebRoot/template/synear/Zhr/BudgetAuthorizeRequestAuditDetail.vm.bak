<html>
<head>
    <title>======</title>
    <link rel="stylesheet" type="text/css" href="../../../js/ZhrCss.css">
    <meta http-equiv="Content-Type" content="text/html; charset=gb2312">

    <script src="../../../js/sunnyfunc.js"></script>

    <script src="../../../js/string.js"></script>

    <script>
var undefined;

function init(){
  uniteCols(document.all.tb);//执行
  //alert(f1.innerText);
  //alert(f3.innerText);
  //alert(parseInt(f3.innerText)-parseInt(f1.innerText))
  f2.innerText=parseInt(f3.innerText)-parseInt(f1.innerText);
}

function uniteTable(thistab,colLength){   
  var rn=thistab.rows.length;//取得行数   
  var rowspann=0;   
  for(j=colLength-1;j>=0;j--){//从第0列开始，合并多少列   
    for(i=rn-1;i>0;i--){//从倒数第一行开始往上检查   
      if(thistab.rows[i].cells[j].innerText==thistab.rows[i-1].cells[j].innerText&&thistab.rows[i].cells[j].colSpan==thistab.rows[i-1].cells[j].colSpan){//与上面一行比较，如果两行相等就合计当前行的合并行数，并删除当前行。   
        rowspann+=thistab.rows[i].cells[j].rowSpan;   
        thistab.rows[i].deleteCell(j);   
      }else{   
        thistab.rows[i].cells[j].rowSpan+=rowspann;//如果不等就完成当前相同数据的合并。   
        rowspann=0;   
      }   
    }   
    //检测无表头的表   
    if(i==0&&rowspann>0){   
      thistab.rows[i].cells[j].rowSpan+=rowspann;//如果不等就完成当前相同数据的合并。   
      rowspann=0;   
    }   
    
  }   
}  
//本业务合并
function uniteCols(thistab){   
  var rn=thistab.rows.length;//取得行数   
  var rowspann=0;   
  for(i=rn-1;i>0;i--){//从倒数第一行开始往上检查   
      if(thistab.rows[i].cells[0].innerText==thistab.rows[i-1].cells[0].innerText&&thistab.rows[i].cells[0].colSpan==thistab.rows[i-1].cells[0].colSpan){//与上面一行比较，如果两行相等就合计当前行的合并行数，并删除当前行。   
        rowspann+=thistab.rows[i].cells[0].rowSpan;   
        thistab.rows[i].deleteCell(0);  
	thistab.rows[i].deleteCell(6);
	thistab.rows[i].deleteCell(6);
      }else{   
        thistab.rows[i].cells[0].rowSpan+=rowspann;//如果不等就完成当前相同数据的合并。
	thistab.rows[i].cells[7].rowSpan+=rowspann;
	thistab.rows[i].cells[8].rowSpan+=rowspann;
        rowspann=0;   
      }   
  }   
  //检测无表头的表   
  if(i==0&&rowspann>0){   
        thistab.rows[i].cells[0].rowSpan+=rowspann;//如果不等就完成当前相同数据的合并。
        thistab.rows[i].cells[7].rowSpan+=rowspann;
	thistab.rows[i].cells[8].rowSpan+=rowspann;
      rowspann=0;   
  }   
} 

function setvalue(step,status){
  document.form1.step.value=step;
  document.form1.status.value=status;
  document.form1.submit();
}
function OpenEdit(a,b,c,d,e){
    location.href='BudgetAuthorizeRequestAuditEdit.aspx?applymonth='+a+'&custpk='+b+'&status='+c+'&areacode='+d+'&step='+e;
}
function OpenEdit2(a){
    var ReturnProductValue=showModalDialog('BudgetAuthorizeRequestAuditLog.aspx?id='+a,'','dialogWidth:750px;dialogHeight:550px;dialogLeft:280px;dialogTop:150px;center:yes; help:yes;resizable:yes;status:yes');
}
    </script>

</head>
<body onload="init()">
    <div class="Main">
        <div class="CaptionTxt">
            费用申请表【 $!form_applymonth 费用申请清单】
        </div>
        <%--<table width="700" height="30"  border="0" align="center" cellpadding="0" cellspacing="0" class="B1">
  <tr>
    <td class="f">&nbsp;&nbsp; <div align="center" class="style1">费用申请表</div></td>
  </tr>
</table>--%>
<form name="form1" method='post' action="BudgetAuthorizeRequestAuditSubmit.aspx" target="dataframe">
        <table id="tb" class="List">
            <tr class="trtitle" bgcolor="abcdef">
                <th width="18%" height="25" nowrap>
                    客户名称
                </th>
                <th width="8%" height="25" nowrap>
                    承担部门
                </th>
                <th width="8%" height="25" nowrap>
                    费用科目
                </th>
                <th width="8%" height="25" nowrap>
                    产品类别
                </th>
                <th width="8%" height="25" nowrap>
                    产品费用预算
                </th>
		<th width="8%" height="25" nowrap>
                    其他费用预算
                </th>
                <th width="8%" height="25" nowrap>
                    说明
                </th>
                <th width="8%" height="25" nowrap>
                    销售目标
                </th>
                <th width="8%" height="25" nowrap>
                    费用预算合计
                </th>
            </tr>
            #set($i=0) #foreach($m in $ZhrGetFeeApplyInfoBody2)
            <tr class="trcolor">
                <td align="center" nowrap>
                    $!m.CUSTNAME<br><font class="FontButton" onclick="OpenEdit('$!m.APPLYMONTH','$!m.NC_CUST_PK','$!form_status','$!form_areacode','$!form_step');">修改</font>&nbsp&nbsp<font class="FontButton"  onclick="OpenEdit2('$!m.FEEID');">记录($!m.AUDITNUM)</font>
                </td>
                <td align="center" nowrap>
                    $!m.CHENGDANBUMEN
                </td>
                <td align="center" nowrap>
                    $!m.FEIYONGKEMU
                </td>
                <td align="center" nowrap>
                    $!m.INVCLASSNAME
                </td>
                <td align="center" nowrap>
		#if($m.DEPETSUBJECT=="20091014132016001"||$m.DEPETSUBJECT=="20091014132016002")
                $!m.PRE_PRODFEE
		#end
		</td>
		<td align="center" nowrap>
		#if($m.DEPETSUBJECT!="20091014132016001"&&$m.DEPETSUBJECT!="20091014132016002")
                $!m.PRE_PRODFEE
		#end
		</td>
                <td align="center" nowrap>
                    $!m.REMARK
                </td>
                <td align="center" nowrap>
                 $!m.PRE_SALEAIM
                </td>
                <td align="center" nowrap>
                    $!m.PRE_ALLFEE
                </td>
            </tr>
            #set($i=$i+1) #end #foreach($m in $ZhrGetFeeApplyInfoBodyTotal)
            <tr class="trcolor">
                <td align="center" nowrap>
                    合计
                </td>
                <td align="center" nowrap>
                    &nbsp;
                </td>
                <td align="center" nowrap>
                     &nbsp;
                </td>
                <td align="center" nowrap>
                    &nbsp;
                </td>
                <td align="center" nowrap id="f1">
                    $!m.PRE_PRODFEE
                </td>
                <td align="center" nowrap id="f2">
                    
                </td>
                <td align="center" nowrap>
		&nbsp;
		</td>
                <td align="center" nowrap>
                    $!m.PRE_SALEAIM
                </td>
                <td align="center" nowrap id="f3">
                    $!m.PRE_ALLFEE
                </td>
            </tr>
            #end
        </table>
        <br>
        <div class="CaptionTxt">
            审核记录</div>
        <table class="List">
            <tr class="trtitle" bgcolor="abcdef">
                <th width="8%" height="25" nowrap>
                    审核时间
                </th>
                <th width="8%" height="25" nowrap>
                    审核人
                </th>
                <th width="8%" height="25" nowrap>
                    审核结果
                </th>
                <th width="58%" height="25" nowrap>
                    审核意见
                </th>
            </tr>
            #foreach($m in $getAudiRemark)
            <tr class="trcolor">
                <td align="center" nowrap>
                    $!m.AUDIDATE
                </td>
                <td align="center" nowrap>
                    $!m.NAME
                </td>
                <td align="center" nowrap>

                    <script>'$!m.AUDISTATUS'.toRealText('F','同意','不同意').write()</script>

                </td>
                <td align="center" nowrap>
                    $!m.REMARK &nbsp;
                </td>
            </tr>
            #end
        </table>
        <input name="applymonth" type="hidden" value="$!form_applymonth">
        <input name="username" type="hidden" value="$!form_username">
        <input name="areacode" type="hidden" value="$!form_areacode">
        <input name="step" type="hidden" value="1">
        <input name="oldstep" type="hidden" value="$!form_step">
        <input name="status" type="hidden" value="$!form_status">
        #if($form_step==0) #else
        <div class="CaptionTxt">
            审核意见<textarea name="remark" cols="120" rows="3"></textarea>
        </div>
        #end
        </form>
        <form name="form2" method='post' action="BudgetAuthorizeRequestApplyEdit.aspx">
        <input name="applymonth" type="hidden" value="$!form_applymonth">
        <input name="custpk" type="hidden" value="$!form_custpk">
	<input name="status" type="hidden" value="$!form_status">
        </form>
        <div align="center">
            #if($form_step==0)
            <input type="button" class="login2" value=" 修  改 " name="B222" onclick="javascript:document.form2.submit();">&nbsp;&nbsp;&nbsp;&nbsp;
            #elseif($form_step=="") #else
            <input type="button" class="login2" value=" 通  过 " name="B222" onclick="javascript:setvalue('1','F');">&nbsp;&nbsp;&nbsp;&nbsp;
            <input type="button" class="login2" value=" 退  回 " name="B222" onclick="javascript:setvalue('-1','R');">&nbsp;&nbsp;&nbsp;&nbsp;
            #end
            <input type="button" class="login2" value=" 返  回 " name="B222" onclick="javascript:location.href='BudgetAuthorizeRequestAudit.aspx';">
        </div>
        <iframe name="dataframe" src="" width="0" height="0"></iframe>
    </div>
</body>
</html>
