<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=gb2312" />
<link rel="stylesheet" type="text/css" href="../../js/style.css">
<link rel="stylesheet" type="text/css" href="../../js/spellCode.css">
<title></title>
<script language="javascript">
	var sellist = new Array();
		sellist = [['序号','角色名','角色ID','公司ID','公司']
		#set($i=1)
		#foreach($!m in $selsyscorpsysuser)
		,['$i','$m.PK_CORP','$m.UNITNAME','$m.FLAG']
		#set($i=$i+1)
		#end
		]
	var pageSize=15;
	var pageno=0;
	var rdata=new Array();
	rdata=sellist;
function toPage2(){
  var element=document.all.pgs;
  if(element.value.search("^-?\\d+(\\.\\d+)?$")!=0){
     alert("页数必须为大于1且小于"+Math.ceil((rdata.length-1)/pageSize)+"的整数!");
     element.focus();
     return false;
  }
  if(element.value<1){
     alert("页数必须为大于1且小于"+Math.ceil((rdata.length-1)/pageSize)+"的整数!");
     element.focus();
     return false;
  }
  if(element.value>Math.ceil((rdata.length-1)/pageSize)){
     alert("页数必须为大于1且小于"+Math.ceil((rdata.length-1)/pageSize)+"的整数!");
     element.focus();
     return false;
  }
  toPage(element.value) 
}
function toPage(page){
try{
  pageno=page;
  for(var i=tab.rows.length;i>1;i--) tab.deleteRow(i-1);
  for(var i=1;i<=pageSize;i++){
    if(((page-1)*pageSize+i)<rdata.length){
  	  var row=tab.insertRow()
	  if(rdata[(page-1)*pageSize+i][3]=='Y') row.insertCell().innerHTML="<input type=checkbox name=checkbox value='checkbox' checked onclick=\"javascript:setStatus("+i+")\">";
	  else{
	     row.insertCell().innerHTML="<input type=checkbox name=checkbox value='checkbox' onclick=\"javascript:setStatus("+i+")\">";
	  }
	  row.insertCell().innerText=rdata[(page-1)*pageSize+i][2]
	  row.insertCell().innerText=rdata[(page-1)*pageSize+i][1]
	 }
 }
 var apg=Math.ceil((rdata.length-1)/pageSize);
 var npg=parseInt(page)+1;
 var ppg=parseInt(page)-1;
 var pagetext="共<font color=red>"+apg+"</font>页<font color=red>"+(rdata.length-1)+"</font>条记录，每页显示<font color=red>"+pageSize+"</font>条，目前是第<font color=red>"+page+"</font>页<br>&nbsp;&nbsp;&nbsp;&nbsp;";
 if(page<apg) pagetext+="<a style='cursor:hand' onclick='toPage2()'><font color=blue>转到</font></a><input type=text id=pgs size=3 value="+npg+">&nbsp;&nbsp;&nbsp;&nbsp;";
 else  pagetext+="<a style='cursor:hand' onclick='toPage2()'><font color=blue>转到</font></a><input type=text id=pgs size=3 value=1>&nbsp;&nbsp;&nbsp;&nbsp;";
 if(page>1) pagetext+="<a style='cursor:hand' onclick='toPage(1)'><font color=blue>首页</font></a>&nbsp;&nbsp;<a style='cursor:hand' onclick='toPage("+ppg+")'><font color=blue>上一页</font></a>&nbsp;&nbsp;"
 if(page<apg) pagetext+="<a style='cursor:hand' onclick='toPage("+npg+")'><font color=blue>下一页</font></a>&nbsp;&nbsp;<a style='cursor:hand' onclick='toPage("+apg+")'><font color=blue>尾页</font></a>&nbsp;&nbsp;"
 
 document.all.pg.innerHTML=pagetext;
 }catch(e){
   alert(e.description)
 }
}
function setStatus(lineno)
{
   if(document.all.checkbox[lineno].checked){
      document.all.checkbox[lineno].value = 'Y';
   }else{
      document.all.checkbox[lineno].value = 'N';
   }  
   savepage(pageno);
}
function seldata(obj)
{
  for(var i=1;i<tab.rows.length;i++){
      document.all.checkbox[i].checked=obj.checked
  }
  savepage(pageno);
}
function savepage(page)
{
  if(page>0){
    for(var i=1;i<tab.rows.length;i++){
      if(document.all.checkbox[i].checked) rdata[(page-1)*pageSize+i][3]='Y';
      else  rdata[(page-1)*pageSize+i][3]='N';
      sellist[rdata[(page-1)*pageSize+i][0]]=rdata[(page-1)*pageSize+i];
    }
  }
}
function save()
{
   savepage(pageno);
   var count = 0;
   var datahtml="";
   for(var i=0;i<sellist.length;i++){
      if(sellist[i][3]=='Y'){
         count ++;
	 if(count==1){
            datahtml="<input type=hidden name=corpid value='"+sellist[i][1]+"'>";
	 }else{
	    datahtml+="<input type=hidden name=corpid value='"+sellist[i][1]+"'>";
	 }
      }
   }
   subdata.innerHTML=datahtml+"<input type='hidden' name='username' value='$!form_username'>";
   form_submit.action="modsavecorpuserpur.aspx";
   form_submit.submit();
}
</script>
</head>

<body>
<table class="datatable">
  <tr class="trcolor">
    <td>用户姓名:
	$!form_name
    </td>
    <td>用户名:
	$!form_username
    </td>
  </tr>
</table>
<table class="datatable" id='tab'>
  <tr class="trcolor">
    <td width="10%"><input type=checkbox name=checkbox value='checkbox' onclick="seldata(this)">状态</td>
    <td width="40%">公司</td>
    <td>公司ID</td>
  </tr>
</table>
<div style="width:100%;txt-align:center;border:0 double gray;">
<input type="button" value=" 提  交 " onclick="save()">&nbsp;&nbsp;&nbsp;&nbsp;<input type="button" class="login2" value=" 返  回 " name="B222" onClick="javascript:history.back(-1);">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span id="pg"></span>
</div>
<script>
	 toPage(1);
</script>
<form name="form_submit" method="post" target="saveframe">
<span id="subdata"></span>
</form>
</form>
<iframe name="saveframe" src="about:blank" width="100%" height="0" noresize frameborder=0 framespacing=0 marginheight=0 marginwidth=0></iframe> 
</body>
</html>
